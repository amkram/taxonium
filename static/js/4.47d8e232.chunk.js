(this.webpackJsonptaxodium=this.webpackJsonptaxodium||[]).push([[4],{185:function(e,t,n){},186:function(e,t){},200:function(e,t){},272:function(e,t,n){"use strict";n.r(t);var r=n(128),a=n(13),o=(n(21),n(1)),i=n(133),c=n(134),s=n(265),l=n(267),u=n(274),d=n(275),m=n(268),b=n(276),h=(n(185),n(2));var g=function(e){var t=e.isShown,n=e.progress;return t?Object(h.jsxs)("div",{className:"w-full h-full fixed bg-white text-center",children:[" ",Object(h.jsx)("div",{className:"loader z-50",children:"Loading..."}),Object(h.jsxs)("div",{className:"text-black",children:["Loading ",n,"%"]})]}):Object(h.jsx)(h.Fragment,{})},j=n(119);function f(e,t,n,r){var a=Object(c.a)(Object(c.a)({},e),{},{data:p(e.data,t,n,r),visible:!0,id:e.id+"_coarse"}),o=function(e){return Object(c.a)(Object(c.a)({},e),{},{id:e.id.replace("main","mini"),lineWidthScale:1,pickable:!1,getRadius:e.id.includes("search")?.5*e.getRadius:e.getRadius})}(a);return[a,Object(c.a)(Object(c.a)({},e),{},{visible:!0,id:e.id+"_fine"}),o]}function p(e,t,n,r){var a={};return e.filter((function(e){if(r&&Math.abs(t.x[e]-t.x[t.parents[e]])>1|Math.abs(t.y[e]-t.y[t.parents[e]])>.5)return!0;var o=Math.round(t.x[e]*n)/n,c=Math.round(t.y[e]*n)/n;return a[o]?!a[o][c]&&(a[o][c]=1,!0):(a[o]=Object(i.a)({},c,1),!0)}))}var x=[{contour:[[-100,-100],[-100,100],[100,100],[100,-100]],zipcode:94107,population:26599,area:6.11}];function O(e){if(void 0===e)return[200,200,200];if("unknown"===e)return[200,200,200];if("USA"===e)return[95,158,245];if("England"===e)return[214,58,15];if("Scotland"===e)return[255,130,82];if("Wales"===e)return[148,49,22];if("Northern Ireland"===e)return[140,42,15];if("France"===e)return[140,28,120];if("Germany"===e)return[106,140,28];if("India"===e)return[61,173,166];if("Denmark"===e)return[24,112,32];var t=0;if(0===(e=e.split("").reverse().join("")).length)return t;for(var n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t),t&=t;var r=[0,0,0];for(n=0;n<3;n++){var a=t>>8*n&255;r[n]=a}return r[0]+r[1]+r[2]<150||r[0]+r[1]+r[2]>500?O(e+"_"):r}var v=function(e){return[1/Math.pow(2,e-5.6),0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},y=function(e){return 7/Math.pow(2,e.zoom-5.6)};var w=function(e){var t=e.data,n=e.colourBy,i=e.progress,p=e.setSelectedNode,w=e.scatterIds,_=e.search_configs_initial,k=e.zoomToSearch,N=Object(o.useState)({ids:[],top:0,bottom:0}),C=Object(a.a)(N,2),S=C[0],M=C[1],A=t.node_data,z=Object(o.useState)(),I=Object(a.a)(z,2),P=I[0],E=I[1],F=Object(o.useState)({zoom:4.7,target:[6,13]}),L=Object(a.a)(F,2),W=L[0],T=L[1],R=Object(o.useRef)(null),B=Object(o.useCallback)((function(e){var t=e.viewId,n=e.viewState;e.oldViewState;if("minimap"!==t&&(n.minimap={zoom:3,target:[5,13]},n.target[0]=y(n),R.current.viewports.length)){var r=R.current.viewports[0],a=r.unproject([0,0,0]),o=r.unproject([r.width,r.height,0]);o[0]=o[0]*Math.pow(2,n.zoom-6),a[0]=a[0]*Math.pow(2,n.zoom-6),n=Object(c.a)(Object(c.a)({},n),{},{nw:a,se:o,needs_update:!1}),a[0]=-500,o[0]=500,T(n)}}),[R]),U=Object(o.useState)(!1),D=Object(a.a)(U,2),q=D[0],G=D[1],H=Object(o.useCallback)((function(e){if(0===e.buttons&&"onPointerMove"===e._reactName)return!1;var t=R.current.pickObject({x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY,radius:1});if("onPointerDown"===e._reactName&&(t&&"minimap"===t.viewport.id?G(!0):G(!1)),t&&"main"===t.viewport.id&&"onClick"===e._reactName&&p(t.object),t||"onClick"!==e._reactName||p(null),t&&"minimap"===t.viewport.id&&q){var n=Object(c.a)(Object(c.a)({},W),{},{target:[y(W),t.coordinate[1]],needs_update:!0});T(n)}}),[W,q,p]),J=Object(o.useMemo)((function(){return new l.a({id:"mini-poly-layer",data:x,pickable:!0,stroked:!0,opacity:.5,filled:!0,wireframe:!0,getPolygon:function(e){return e.contour},getFillColor:function(e){return[240,240,240]},getLineColor:[80,80,80],getLineWidth:1,lineWidthUnits:"pixels"})}),[]),K=Object(o.useMemo)((function(){return{data:w.filter((function(){return!0})),visible:!0,opacity:.6,getRadius:3,radiusUnits:"pixels",id:"main-scatter",pickable:!0,getLineColor:[100,100,100],lineWidthUnits:"pixels",lineWidthScale:1,onHover:function(e){return E(e)},getPosition:function(e){return[A.x[e],A.y[e]]},getFillColor:function(e){return"lineage"===n?O(t.lineage_mapping[A.lineages[e]]):"country"===n?O(t.country_mapping[A.countries[e]]):[200,200,200]}}}),[w,A,t,n]),V=Object(o.useMemo)((function(){return f(K,A,100)}),[K,A]),Z=Object(o.useMemo)((function(){return V.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:v(W.zoom),stroked:e.id.includes("mini")?void 0:W.zoom>15,radiusMaxPixels:e.id.includes("mini")?2:W.zoom>15?W.zoom/5:3})}))}),[V,W.zoom]),Q=Object(o.useMemo)((function(){return Z.map((function(e){return new u.a(e)}))}),[Z]),X=Object(o.useMemo)((function(){var e;return(e=[]).concat.apply(e,Object(r.a)(_.map((function(e){return f(e,A,100)}))))}),[_,A]),Y=Object(o.useMemo)((function(){return X.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:v(W.zoom)})}))}),[X,W.zoom]),$=Object(o.useMemo)((function(){return Y.map((function(e){return new u.a(e)}))}),[Y]),ee=Object(o.useMemo)((function(){return{id:"main-line",data:A.ids,pickable:!1,getWidth:1,getTargetPosition:function(e){return[A.x[A.parents[e]],A.y[e]]},getSourcePosition:function(e){return[A.x[e],A.y[e]]},getColor:[150,150,150]}}),[A]),te=Object(o.useMemo)((function(){return{id:"main-line-2",data:A.ids,pickable:!1,getWidth:1,getTargetPosition:function(e){return[A.x[A.parents[e]],A.y[A.parents[e]]]},getSourcePosition:function(e){return[A.x[A.parents[e]],A.y[e]]},getColor:[150,150,150]}}),[A]),ne=Object(o.useMemo)((function(){return[].concat.apply([],[ee,te].map((function(e){return f(e,A,100,!0)})))}),[ee,te,A]),re=Object(o.useMemo)((function(){return ne.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:v(W.zoom)})}))}),[ne,W.zoom]),ae=Object(o.useMemo)((function(){return re.map((function(e){return new d.a(e)}))}),[re]);if(W.zoom>17&&!0!==W.needs_update)if(W.nw[1]>S.top&W.se[1]<S.bottom);else{var oe=W.nw[1],ie=W.se[1],ce=ie-oe,se=oe-4*ce,le=ie+4*ce,ue=w.filter((function(e){return A.y[e]>se&A.y[e]<le}));M({top:se,bottom:le,ids:ue})}var de=Object(o.useMemo)((function(){return{id:"main-text-layer",data:S.ids,getPosition:function(e){return[A.x[e]+.3,A.y[e]]},getText:function(e){return A.names[e]},getColor:[180,180,180],getAngle:0,billboard:!0,getTextAnchor:"start",getAlignmentBaseline:"center"}}),[A,S]),me=Object(o.useMemo)((function(){return[new m.a(Object(c.a)(Object(c.a)({},de),{},{visible:W.zoom>18.5,getSize:W.zoom>19?12:9.5,modelMatrix:v(W.zoom)}))]}),[de,W]),be=Object(o.useMemo)((function(){var e;return console.log(W),e=void 0!==W.nw?[{contour:[[-100,-100],[100,-100],[100,W.nw[1]],[-100,W.nw[1]]],color:[100,100,100]},{contour:[[-100,W.nw[1]],[100,W.nw[1]],[100,W.se[1]],[-100,W.se[1]]],color:[255,255,255]},{contour:[[-100,W.se[1]],[100,W.se[1]],[100,300],[-100,300]],color:[150,150,150]}]:[],new l.a({id:"mini-pos",data:e,opacity:.05,radiusMinPixels:4,radiusMaxPixels:4,getRadius:4,getLineWidth:.1,getPolygon:function(e){return e.contour},getFillColor:function(e){return e.color}})}),[W]),he=Object(o.useMemo)((function(){return[J].concat(Object(r.a)(me),Object(r.a)(ae),Object(r.a)(Q),Object(r.a)($),[be])}),[J,me,Q,ae,be,$]);window.deck=R;var ge=Object(o.useMemo)((function(){return[new b.a({id:"main",controller:!0}),new b.a({id:"minimap",x:"79%",y:"1%",width:"20%",height:"35%",borderWidth:"1px",controller:!0})]}),[]),je=Object(o.useMemo)((function(){if(P&&P.object)return Object(h.jsx)(h.Fragment,{children:P.object})}),[P]),fe=Object(o.useMemo)((function(){return 0===A.ids.length}),[A]),pe=Object(o.useCallback)((function(e){var t=Object(c.a)(Object(c.a)({},W),{},{zoom:W.zoom+e,needs_update:!0}),n=Object(c.a)(Object(c.a)({},t),{},{target:[y(t),t.target[1]]});T(n)}),[W]);return Object(o.useEffect)((function(){if(null!==k.index){console.log(k);var e=Object(c.a)(Object(c.a)({},W),{},{zoom:19,needs_update:!0}),t=Object(c.a)(Object(c.a)({},e),{},{target:[y(e),A.y[_.filter((function(e){return e.original_index===k.index}))[0].data[0]]]});T(t)}}),[k]),Object(h.jsxs)("div",{className:"w-full h-full relative",onClick:H,onPointerMove:H,onPointerDown:H,children:[" ",Object(h.jsxs)(s.a,{onAfterRender:function(){(void 0===W.nw||W.needs_update)&&B({viewState:W})},ref:R,views:ge,viewState:W,onViewStateChange:B,layerFilter:Object(o.useCallback)((function(e){var t=e.layer,n=e.viewport;return(t.id.startsWith("main")&&"main"===n.id||t.id.startsWith("mini")&&"minimap"===n.id&&!0!==window.hidemini)&(t.id.includes("mini")|W.zoom<8&!t.id.includes("fine")|W.zoom>8&!t.id.includes("coarse"))}),[W.zoom]),controller:!0,layers:he,children:[je,Object(h.jsxs)("div",{style:{position:"absolute",right:"0.2em",bottom:"0.2em"},children:[Object(h.jsx)("button",{className:" w-12 h-10 bg-gray-100  p-1 rounded border-gray-300 text-gray-700 opacity-60 hover:opacity-100",onClick:function(){pe(.6)},children:Object(h.jsx)(j.b,{className:"mx-auto  w-5 h-5 "})}),Object(h.jsx)("button",{className:" w-12 h-10 bg-gray-100 ml-1 p-1 rounded border-gray-300 text-gray-700  opacity-60  hover:opacity-100",onClick:function(){pe(-.6)},children:Object(h.jsx)(j.c,{className:"mx-auto w-5 h-5 "})})]})]}),fe&&Object(h.jsx)(g,{isShown:!0,progress:i})]})},_=n(12),k=n(204);var N=function(e){var t,n=e.id,r=e.category,a=e.enabled,o=e.value,i=e.setThis,c=e.removeItem,s=e.index,l=e.searchColors,u=e.numResultsHere,d=e.zoomToMe,m=l[s%l.length];return Object(h.jsxs)("div",{className:"border-gray-100 border-b mb-3 pb-3",children:[Object(h.jsx)("input",{name:"isGoing",type:"checkbox",style:{outline:a&&o.length>0?"1px solid rgb(".concat(m[0],",").concat(m[1],",").concat(m[2],")"):"0px",outlineOffset:"2px"},className:"w-3 h-3 m-3",checked:a,onChange:function(e){return i({enabled:!a})}}),Object(h.jsxs)("select",{className:" w-36 border py-2 px-1 text-grey-darkest text-sm h-10",value:r,onChange:function(e){return i({category:e.target.value})},children:[Object(h.jsx)("option",{value:"name",children:"Sequence name"}),Object(h.jsx)("option",{value:"lineage",children:"Lineage"}),Object(h.jsx)("option",{value:"country",children:"Country"}),Object(h.jsx)("option",{value:"mutation",children:"AA mutation"})]}),"\xa0",Object(h.jsx)(k.DebounceInput,{className:" w-32 border py-2 px-3 text-grey-darkest h-10",value:o,onChange:function(e){return i({value:e.target.value})},debounceTimeout:300}),Object(h.jsx)("button",{className:" bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border  text-gray-700 ml-2 h-8",onClick:function(){return c(n)},children:Object(h.jsx)(_.c,{className:"inline-block "})}),Object(h.jsx)("div",{className:"text-sm text-gray-600 px-3",children:{name:"Enter a sequence name like QEUH-13ADA01",lineage:"Enter a PANGO lineage like B.1.1.7. Note that sub-lineages will not be found by this method.",country:"Enter a country like 'India' ",mutation:"Enter an amino acid mutation like S:E484K"}[r]}),Object(h.jsxs)("div",{className:"text-sm text-gray-900 px-3",children:[" ",o.length>0&&Object(h.jsxs)(h.Fragment,{children:[" ",(t=u,new Intl.NumberFormat("en-US").format(t))," result",1!==u&&Object(h.jsx)(h.Fragment,{children:"s"})]}),1===u&&a&&Object(h.jsxs)(h.Fragment,{children:[" ",Object(h.jsxs)("button",{onClick:d,className:"inline-block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-1 text-gray-700",children:[Object(h.jsx)(j.b,{className:"inline-block mr-1"}),"locate"]})]})]})]})},C=n(207),S=n(208);var M=function(e){var t,n=e.searchItems,a=e.setSearchItems,o=e.colourBy,i=e.setColourBy,s=e.selectedNode,l=e.data,u=e.searchColors,d=e.numSearchResults,m=e.totalSeqs,b=e.setZoomToSearch,g=l.node_data;return Object(h.jsxs)("div",{children:[Object(h.jsxs)("div",{className:" border-t md:border-t-0 border-b border-gray-300",children:[Object(h.jsxs)("div",{className:"mt-3 mb-3 text-gray-500 text-sm",children:["Displaying ",(t=m,new Intl.NumberFormat("en-US").format(t))," sequences from INSDC, COG-UK and CNCB"]}),Object(h.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(h.jsx)(C.a,{className:"inline-block mr-2"}),"Search"]}),n.map((function(e,t){return Object(h.jsx)(N,{numResultsHere:d[t],searchColors:u,index:t,id:e.id,category:e.category,value:e.value,setThis:function(e){n[t]=Object(c.a)(Object(c.a)({},n[t]),e),a(Object(r.a)(n))},zoomToMe:function(){console.log(t),b({index:t})},removeItem:function(e){a(n.filter((function(t){return t.id!==e})))},enabled:e.enabled},e.id)})),Object(h.jsxs)("button",{className:"block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-5 text-gray-700",onClick:function(){return a([].concat(Object(r.a)(n),[{id:Math.random(),category:"name",value:"",enabled:!0}]))},children:[Object(h.jsx)(S.a,{className:"inline-block mr-2"}),"Add a new search"]})]}),Object(h.jsxs)("div",{className:"border-b border-gray-300 pb-3",children:[Object(h.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(h.jsx)(j.a,{className:"inline-block mr-2"}),"Colour by"]}),Object(h.jsxs)("select",{className:"border py-2 px-3 text-grey-darkest",value:o,onChange:function(e){return i(e.target.value)},children:[Object(h.jsx)("option",{value:"lineage",children:"Lineage"}),Object(h.jsx)("option",{value:"country",children:"Country"}),Object(h.jsx)("option",{value:"none",children:"None"})]})]}),Object(h.jsx)("div",{children:s&&Object(h.jsxs)("div",{className:"text-gray-500 mr-3",children:[Object(h.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(h.jsx)(_.a,{className:"inline-block mr-2"}),"Node info"]}),Object(h.jsx)("div",{className:"font-bold",children:g.names[s]}),g.genbanks[s]&&"unknown"!==g.genbanks[s]&&"nan"!==g.genbanks[s]&&Object(h.jsxs)("div",{children:[Object(h.jsx)("span",{className:"font-semibold",children:"Genbank:"})," ",Object(h.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline",href:"https://www.ncbi.nlm.nih.gov/nuccore/"+g.genbanks[s],children:g.genbanks[s]})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("span",{className:"font-semibold",children:"Date:"})," ",l.date_mapping[g.dates[s]]]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("span",{className:"font-semibold",children:"Lineage:"})," ",Object(h.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:"https://outbreak.info/situation-reports?pango="+l.lineage_mapping[g.lineages[s]],children:l.lineage_mapping[g.lineages[s]]})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("span",{className:"font-semibold",children:"Country:"})," ",l.country_mapping[g.countries[s]]]}),Object(h.jsx)("span",{className:"font-semibold",children:"Mutations:"}),Object(h.jsx)("div",{className:"text-xs mr-5",children:g.mutations[s].mutation&&g.mutations[s].mutation.map((function(e){return l.mutation_mapping[e]})).join(", ")})]})})]})},A=n(209),z=n.n(A);function I(e,t,n,r){for(var a=0,o=t,i=t;o<e.length&&","!=e.charAt(o)&&")"!=e.charAt(o);++o){var c=e.charAt(o);if("["==c){var s=o;0==a&&(a=o);do{++o}while(o<e.length&&"]"!=e.charAt(o));if(o==e.length){n.error|=4;break}meta=e.substr(s,o-s+1)}else if(":"==c){0==a&&(a=o);for(var l=++o;o<e.length;++o){var u=e.charAt(o);if((u<"0"||u>"9")&&"e"!=u&&"E"!=u&&"+"!=u&&"-"!=u&&"."!=u)break}var d=parseFloat(e.substr(l,o-l));--o}else c<"!"&&c>"~"&&0==a&&(a=o)}0==a&&(a=o);var m="";return a>i&&(m=e.substr(i,a-i)),n.names.push(m),n.distances.push(d),n.parents.push(null),n.children.push([]),n.x.push(0),n.y.push(0),n.miny.push(0),n.maxy.push(0),n.hidden.push(!1),o}function P(e,t){var n,r;for(n=new Array,(r=new Array).push({p:t,i:0});;){for(;r[r.length-1].i!=e.children[r[r.length-1].p].length&&!e.hidden[r[r.length-1].p];){var a=r[r.length-1];r.push({p:e.children[a.p][a.i],i:0})}if(n.push(r.pop().p),!(r.length>0))break;++r[r.length-1].i}return n}window.newick="((A:1,EE:5):3,B:2,(C:5,D:2):3)",n(227).parse.defaults.keepCase=!0;var E=[[255,0,0],[183,0,255],[255,213,0],[0,0,255],[0,255,255]];t.default=function(){var e=Object(o.useState)({index:null}),t=Object(a.a)(e,2),n=t[0],i=t[1],c=Object(o.useState)([{id:.123,category:"lineage",value:"",enabled:!0}]),s=Object(a.a)(c,2),l=s[0],u=s[1],d=Object(o.useCallback)((function(e){u(e)}),[]),m=Object(o.useState)("lineage"),b=Object(a.a)(m,2),g=b[0],j=b[1],f=Object(o.useCallback)((function(e){j(e)}),[]),p=Object(o.useState)({status:"not_attempted",data:{node_data:{ids:[]}}}),x=Object(a.a)(p,2),O=x[0],v=x[1],y=Object(o.useState)(null),_=Object(a.a)(y,2),k=_[0],N=_[1];Object(o.useEffect)((function(){z.a.get("/bac120.tree").then((function(e){console.log(e),console.log("start");var t=function(e){var t=new Array,n=new Object;n.error=n.n_tips=0,n.names=new Array,n.distances=new Array,n.parents=new Array,n.children=new Array,n.x=new Array,n.y=new Array,n.miny=new Array,n.maxy=new Array,n.hidden=new Array;for(var r=0;r<e.length;){for(;r<e.length&&(e.charAt(r)<"!"||e.charAt(r)>"~");)++r;if(r==e.length)break;var a=e.charAt(r);if(","==a)++r;else if("("==a)t.push(-1),++r;else if(")"==a){var o,i,c;for(o=n.names.length,c=t.length-1;c>=0&&!(t[c]<0);--c);if(c<0){n.error|=1;break}for(r=I(e,r+1,n,i=t.length-1-c),c=t.length-1,i-=1;i>=0;--i,--c)n.children[o][i]=t[c],n.parents[t[c]]=o;t.length=c,t.push(o)}else++n.n_tips,t.push(n.names.length),r=I(e,r,n)}return t.length>1&&(n.error|=2),n.root=n.names.length-1,n}(e.data);console.log("order"),function(e,t){var n,r={},a={},o={},i=function(e,t){return o[e]/a[e]-o[t]/a[t]},c=new Array,s=P(e,t);for(window.node=s,r[s.length-1]=0,n=s.length-2;n>=0;--n){var l=s[n];r[l]=r[e.parents[l]]+1,0==e.children[l].length&&c.push(l)}for(c.sort((function(t,n){return r[t]<r[n]?1:r[t]>r[n]||String(e.names[t])<String(e.names[n])?-1:String(e.names[t])>String(e.names[n])?1:0})),n=0;n<c.length;++n)o[c[n]]=n,a[c[n]]=1;for(n=0;n<s.length;++n)if(l=s[n],e.children[l].length){var u,d=0,m=0;for(u=0;u<e.children[l].length;++u)d+=a[e.children[l][u]],m+=o[e.children[l][u]];a[l]=d,o[l]=m}for(n=0;n<s.length;++n)e.children[s[n]].length>=2&&e.children[s[n]].sort(i)}(t,t.root),console.log("expand"),t.node_order=P(t,t.root),t.parents[t.root]=t.root,console.log("xy"),function(e,t){var n,r,a;for(a=e.n_tips-1,n=r=0;n<e.names.length;++n)e.y[e.node_order[n]]=e.children[e.node_order[n]].length&&!e.hidden[e.node_order[n]]?(e.y[e.children[e.node_order[n]][0]]+e.y[e.children[e.node_order[n]][e.children[e.node_order[n]].length-1]])/2:r++/a,0==e.children[e.node_order[n]].length?e.miny[e.node_order[n]]=e.maxy[e.node_order[n]]=e.y[e.node_order[n]]:(e.miny[e.node_order[n]]=e.miny[e.children[e.node_order[n]][0]],e.maxy[e.node_order[n]]=e.maxy[e.children[e.node_order[n]][e.children[e.node_order[n]].length-1]]);if(t){var o=e.names.length-1;for(a=e.x[o]=e.distances[o]>=0?e.distances[o]:0,n=e.names.length-2;n>=0;--n)e.x[n]=e.x[e.parents[n]]+(e.distances[n]>=0?e.distances[n]:0),e.x[n]>a&&(a=e.x[n]);0==a&&(t=!1)}if(!t){for(a=e.x[e.names.length-1]=1,n=e.names.length-2;n>=0;--n)e.x[n]=e.x[e.parents[n]]+1,e.x[n]>a&&(a=e.x[n]);for(n=0;n<e.names.length-1;++n)0==e.children[n].length&&(e.x[n]=a)}for(n=0;n<e.names.length;++n)e.x[n]/=a}(t,!0),console.log("done"),t.x=t.x.map((function(e){return 15*(e+.1)})),t.y=t.y.map((function(e){return 30*(e+.1)})),t.ids=Object(r.a)(Array(t.names.length).keys()),v({status:"loaded",data:{node_data:t}})}))}),[]);var C=Object(o.useMemo)((function(){return"loaded"===O.status?O.data:{node_data:{ids:[]}}}),[O]),S=Object(o.useMemo)((function(){return C.node_data.ids.filter((function(e){return""!==C.node_data.names[e]}))}),[C]),A=Object(o.useMemo)((function(){var e=l.map((function(e,t){var n,r=e.value.toLowerCase().trim();if("mutation"===e.category){var a=C.mutation_mapping.indexOf(e.value);n=function(e){return C.node_data.mutations[e].mutation&&C.node_data.mutations[e].mutation.includes(a)}}"name"===e.category&&(n=function(e){return C.node_data.names[e].toLowerCase().includes(r)}),"country"===e.category&&(n=function(e){return C.country_mapping[C.node_data.countries[e]].toLowerCase()===r}),"lineage"===e.category&&(n=function(e){return C.lineage_mapping[C.node_data.lineages[e]].toLowerCase()===r});var o=null!==e.value&&""!==e.value&&e.enabled;return{original_index:t,id:"main-search-"+t,enabled:o,data:""!==e.value?S.filter(n):[],opacity:.7,getRadius:7+2*t,filled:!1,stroked:!0,radiusUnits:"pixels",lineWidthUnits:"pixels",lineWidthScale:1,getPosition:function(e){return[C.node_data.x[e],C.node_data.y[e]]},getFillColor:function(e){return[0,0,0]},getLineColor:function(e){return E[t%E.length]}}})),t=e.map((function(e){return e.data.length}));return[e.filter((function(e){return e.enabled})),t,S.length]}),[C,l,S]),F=Object(a.a)(A,3),L=F[0],W=F[1],T=F[2];return Object(h.jsx)("div",{className:"main_content",children:Object(h.jsxs)("div",{className:"md:grid md:grid-cols-12 h-full",children:[Object(h.jsx)("div",{className:"md:col-span-8 h-3/6 md:h-full w-full",children:Object(h.jsx)(w,{search_configs_initial:L,scatterIds:S,searchColors:E,setSelectedNode:N,searchItems:l,data:C,progress:O.progress,colourBy:g,zoomToSearch:n})}),Object(h.jsx)("div",{className:"md:col-span-4 h-full bg-white  border-gray-600   pl-5 shadow-xl",children:Object(h.jsx)(M,{setZoomToSearch:i,totalSeqs:T,numSearchResults:W,searchColors:E,selectedNode:k,searchItems:l,data:C,setSearchItems:d,colourBy:g,setColourBy:f})})]})})}}}]);
//# sourceMappingURL=4.47d8e232.chunk.js.map