(this.webpackJsonptaxodium=this.webpackJsonptaxodium||[]).push([[0],{152:function(e,t){},209:function(e,t,n){},210:function(e,t,n){},211:function(e,t,n){},213:function(e,t){},259:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n(185),i=n.n(r),o=(n(209),n(52)),s=n(15),c=n(39),l=(n(210),n(120)),u=n(272),d=n(274),b=n(279),m=n(280),j=n(275),h=n(281),f=(n(211),n(4));var g=function(e){var t=e.isShown,n=e.progress;return t?Object(f.jsxs)("div",{className:"w-full h-full fixed bg-white text-center",children:[" ",Object(f.jsx)("div",{className:"loader z-50",children:"Loading..."}),Object(f.jsxs)("div",{className:"text-black",children:["Loading ",n,"%"]})]}):Object(f.jsx)(f.Fragment,{})},p=n(82);function x(e,t,n,a){var r=Object(s.a)(Object(s.a)({},e),{},{data:O(e.data,t,n,a),visible:!0,id:e.id+"_coarse"}),i=function(e){return Object(s.a)(Object(s.a)({},e),{},{id:e.id.replace("main","mini"),lineWidthScale:1,pickable:!1,getRadius:e.id.includes("search")?.5*e.getRadius:e.getRadius})}(r);return[r,Object(s.a)(Object(s.a)({},e),{},{visible:!0,id:e.id+"_fine"}),i]}function O(e,t,n,a){var r={};return e.filter((function(e){if(a&&Math.abs(t.x[e]-t.x[t.parents[e]])>1|Math.abs(t.y[e]-t.y[t.parents[e]])>.5)return!0;var i=Math.round(t.x[e]*n)/n,o=Math.round(t.y[e]*n)/n;return r[i]?!r[i][o]&&(r[i][o]=1,!0):(r[i]=Object(l.a)({},o,1),!0)}))}var v=[{contour:[[-100,-100],[-100,100],[100,100],[100,-100]],zipcode:94107,population:26599,area:6.11}],y={};function _(e){if(y[e])return y[e];var t=function(e){var t={A:[230,25,75],R:[60,180,75],N:[255,225,25],D:[67,99,216],C:[245,130,49],Q:[70,240,240],E:[145,30,180],G:[240,50,230],H:[188,246,12],I:[250,190,190],L:[230,0,255],K:[0,128,128],M:[154,99,36],F:[255,250,200],P:[128,0,0],T:[170,255,195],W:[128,128,0],Y:[0,0,117],V:[0,100,177],X:[128,128,128],O:[255,255,255],Z:[0,0,0]};if(t[e])return t[e];if(void 0===e)return[200,200,200];if(""===e)return[200,200,200];if("unknown"===e)return[200,200,200];if("USA"===e)return[95,158,245];if("England"===e)return[214,58,15];if("Scotland"===e)return[255,130,82];if("Wales"===e)return[148,49,22];if("Northern Ireland"===e)return[140,42,15];if("France"===e)return[140,28,120];if("Germany"===e)return[106,140,28];if("India"===e)return[61,173,166];if("Denmark"===e)return[24,112,32];e=e.split("").reverse().join("");var n=0;if(0===e.length)return n;for(var a=0;a<e.length;a++)n=e.charCodeAt(a)+((n<<5)-n),n&=n;var r=[0,0,0];for(a=0;a<3;a++){var i=n>>8*a&255;r[a]=i}if(r[0]+r[1]+r[2]<150||r[0]+r[1]+r[2]>500)return _(e+"_");return r}(e);return y[e]=t,t}function N(e){var t=_(e);return"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")")}var w=function(e){return 7/Math.pow(2,e.zoom-5.6)};var C=function(e){var t=e.showMutText,n=e.data,r=e.colourBy,i=e.progress,l=e.setSelectedNode,O=e.scatterIds,y=e.search_configs_initial,C=e.zoomToSearch,k=e.selectedNode;console.log("M",t);var S=Object(a.useState)({ids:[],top:0,bottom:0}),M=Object(c.a)(S,2),T=M[0],I=M[1],R=n.node_data,A=Object(a.useState)(),P=Object(c.a)(A,2),z=P[0],E=P[1],L=Object(a.useState)({zoom:4.7,target:[6,13]}),U=Object(c.a)(L,2),B=U[0],D=U[1],F=Object(a.useState)(0),W=Object(c.a)(F,2),G=W[0],q=(W[1],Object(a.useMemo)((function(){return[1/Math.pow(2,B.zoom-G-5.6),0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}),[B.zoom,G])),V=Object(a.useRef)(null),H=Object(a.useCallback)((function(e){var t=e.viewId,n=e.viewState;e.oldViewState;if("minimap"!==t&&(n.minimap={zoom:3,target:[5,13]},n.target[0]=w(n),V.current.viewports.length)){var a=V.current.viewports[0],r=a.unproject([0,0,0]),i=a.unproject([a.width,a.height,0]);i[0]=i[0]*Math.pow(2,n.zoom-6),r[0]=r[0]*Math.pow(2,n.zoom-6),n=Object(s.a)(Object(s.a)({},n),{},{nw:r,se:i,needs_update:!1}),r[0]=-500,i[0]=500,D(n)}}),[V,G]),J=Object(a.useState)(!1),K=Object(c.a)(J,2),Y=K[0],X=K[1],Z=Object(a.useCallback)((function(e){if(0===e.buttons&&"onPointerMove"===e._reactName)return!1;var t=V.current.pickObject({x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY,radius:10});if("onPointerDown"===e._reactName&&(t&&"minimap"===t.viewport.id?X(!0):X(!1)),t&&"main"===t.viewport.id&&"onClick"===e._reactName&&l(t.object),t||"onClick"!==e._reactName||l(null),t&&"minimap"===t.viewport.id&&Y){var n=Object(s.a)(Object(s.a)({},B),{},{target:[w(B),t.coordinate[1]],needs_update:!0});H({viewState:n,oldViewState:B})}}),[B,Y,l,H]),Q=Object(a.useMemo)((function(){return new d.a({id:"mini-poly-layer",data:v,pickable:!0,stroked:!0,opacity:.5,filled:!0,wireframe:!0,getPolygon:function(e){return e.contour},getFillColor:function(e){return[240,240,240]},getLineColor:[80,80,80],getLineWidth:1,lineWidthUnits:"pixels"})}),[]),$=Object(a.useMemo)((function(){var e={};console.log(r);return function(t,a,r){for(var i=t,o=[],s=function(){var t=null;o.push(i);var s=void 0;if(e[i]?t=e[i]:((s=R.mutations[i].mutation&&R.mutations[i].mutation.filter((function(e){return n.mutation_mapping[e].gene===a&&n.mutation_mapping[e].position===r})))&&1===s.length&&(t=n.mutation_mapping[s[0]].final_res),R.parents[i]===i&&null==t&&(t="X")),t)return o.forEach((function(n){e[n]=t})),{v:t};i=R.parents[i]};;){var c=s();if("object"===typeof c)return c.v}}}),[R,n,r]),ee=Object(a.useMemo)((function(){return{data:O.filter((function(){return!0})),visible:!0,opacity:.6,getRadius:3,radiusUnits:"pixels",id:"main-scatter",pickable:!0,getLineColor:[100,100,100],lineWidthUnits:"pixels",lineWidthScale:1,onHover:function(e){return E(e)},getPosition:function(e){return[R.x[e],R.y[e]]},getFillColor:function(e){return"lineage"===r.variable?_(n.lineage_mapping[R.lineages[e]]):"country"===r.variable?_(n.country_mapping[R.countries[e]]):"aa"===r.variable?_($(e,r.gene,r.residue)):[200,200,200]}}}),[O,R,n,r,$]),te=Object(a.useMemo)((function(){return x(ee,R,100)}),[ee,R]),ne=Object(a.useMemo)((function(){return te.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:q,stroked:e.id.includes("mini")?void 0:B.zoom>15,radiusMaxPixels:e.id.includes("mini")?2:B.zoom>15?B.zoom/5:3})}))}),[te,B,q]),ae=Object(a.useMemo)((function(){return ne.map((function(e){return new b.a(e)}))}),[ne]),re=Object(a.useMemo)((function(){return new b.a({data:k?[k]:[],visible:!0,opacity:1,getRadius:6,radiusUnits:"pixels",id:"main-selected",filled:!1,stroked:!0,modelMatrix:q,getLineColor:[0,0,0],getPosition:function(e){return[R.x[e],R.y[e]]},lineWidthUnits:"pixels",lineWidthScale:2})}),[k,R,q]),ie=Object(a.useMemo)((function(){var e;return(e=[]).concat.apply(e,Object(o.a)(y.map((function(e){return x(e,R,100)}))))}),[y,R]),oe=Object(a.useMemo)((function(){return ie.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:q})}))}),[ie,q]),se=Object(a.useMemo)((function(){return oe.map((function(e){return new b.a(e)}))}),[oe]),ce=Object(a.useMemo)((function(){return{id:"main-line",data:R.ids.filter((function(e){return!0})),getWidth:1,pickable:!0,onHover:function(e){return E(e)},getTargetPosition:function(e){return[R.x[R.parents[e]],R.y[e]]},getSourcePosition:function(e){return[R.x[e],R.y[e]]},getColor:"aa"===r.variable&&r.colourLines?function(e){return _($(e,r.gene,r.residue))}:[150,150,150]}}),[R,r,$]),le=Object(a.useMemo)((function(){return{id:"main-line-2",data:R.ids.filter((function(e){return!0})),pickable:!1,getWidth:1,getTargetPosition:function(e){return[R.x[R.parents[e]],R.y[R.parents[e]]]},getSourcePosition:function(e){return[R.x[R.parents[e]],R.y[e]]},getColor:"aa"===r.variable&&r.colourLines?function(e){return _($(e,r.gene,r.residue))}:[150,150,150]}}),[R,r,$]),ue=Object(a.useMemo)((function(){return[].concat.apply([],[ce,le].map((function(e){return x(e,R,100,!0)})))}),[ce,le,R]),de=Object(a.useMemo)((function(){return ue.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:q})}))}),[ue,q]),be=Object(a.useMemo)((function(){return de.map((function(e){return new m.a(e)}))}),[de]);if(B.zoom>17&&!0!==B.needs_update)if(B.nw[1]>T.top&B.se[1]<T.bottom);else{var me=B.nw[1],je=B.se[1],he=je-me,fe=me-4*he,ge=je+4*he,pe=O.filter((function(e){return R.y[e]>fe&R.y[e]<ge}));I({top:fe,bottom:ge,ids:pe})}var xe=Object(a.useMemo)((function(){return t?R.ids.filter((function(e){return R.num_tips[e]>10&&R.mutations[e]})):[]}),[R.ids,R.mutations,R.num_tips,t]),Oe=Object(a.useMemo)((function(){return{id:"main-text-layer",data:T.ids,getPosition:function(e){return[R.x[e]+.3,R.y[e]]},getText:function(e){return R.names[e]},getColor:[180,180,180],getAngle:0,billboard:!0,getTextAnchor:"start",getAlignmentBaseline:"center"}}),[R,T]),ve=Object(a.useMemo)((function(){return{id:"main-text-muts-layer",data:xe.filter((function(){return!0})),getPosition:function(e){return[R.x[e],R.y[e]]},getText:function(e){return R.mutations[e].mutation?R.mutations[e].mutation.map((function(e){var t=n.mutation_mapping[e];return t.gene+":"+t.orig_res+t.position+t.final_res})).sort().join(", "):""},getColor:[180,180,180],getAngle:0,billboard:!0,getTextAnchor:"start",getAlignmentBaseline:"center"}}),[n.mutation_mapping,xe,R.mutations,R.x,R.y]),ye=Object(a.useMemo)((function(){return[new j.a(Object(s.a)(Object(s.a)({},Oe),{},{visible:B.zoom>18.5,getSize:B.zoom>19?12:9.5,modelMatrix:q}))]}),[Oe,q,B]),_e=Object(a.useMemo)((function(){return t?[new j.a(Object(s.a)(Object(s.a)({},ve),{},{visible:!0,getSize:B.zoom>19?12:9.5,modelMatrix:q,getColor:[0,0,0]}))]:[]}),[ve,B,q,t]),Ne=Object(a.useMemo)((function(){var e;return e=void 0!==B.nw?[{contour:[[-100,-100],[100,-100],[100,B.nw[1]],[-100,B.nw[1]]],color:[100,100,100]},{contour:[[-100,B.nw[1]],[100,B.nw[1]],[100,B.se[1]],[-100,B.se[1]]],color:[255,255,255]},{contour:[[-100,B.se[1]],[100,B.se[1]],[100,300],[-100,300]],color:[150,150,150]}]:[],new d.a({id:"mini-pos",data:e,opacity:.05,radiusMinPixels:4,radiusMaxPixels:4,getRadius:4,getLineWidth:.1,getPolygon:function(e){return e.contour},getFillColor:function(e){return e.color}})}),[B]),we=Object(a.useMemo)((function(){return[Q].concat(Object(o.a)(ye),Object(o.a)(be),Object(o.a)(ae),Object(o.a)(se),[Ne,re],Object(o.a)(_e))}),[Q,ye,ae,be,Ne,se,re,_e]);window.deck=V;var Ce=Object(a.useMemo)((function(){return[new h.a({id:"main",controller:!0}),new h.a({id:"minimap",x:"79%",y:"1%",width:"20%",height:"35%",borderWidth:"1px",controller:!0})]}),[]),ke=Object(a.useMemo)((function(){if(z&&z.object){var e,t,a=n.lineage_mapping[R.lineages[z.object]],i=n.country_mapping[R.countries[z.object]],o=n.date_mapping[R.dates[z.object]];"aa"===r.variable&&(t=N(e=$(z.object,r.gene,r.residue)));var s=R.mutations[z.object]&&R.mutations[z.object].mutation&&R.mutations[z.object].mutation.map((function(e){var t=n.mutation_mapping[e];return t.gene+":"+t.orig_res+t.position+t.final_res})).sort();return Object(f.jsxs)("div",{className:"bg-gray-100 p-3 opacity-90 text-sm",style:{position:"absolute",zIndex:1,pointerEvents:"none",left:z.x,top:z.y},children:[Object(f.jsx)("h2",{className:"font-bold",children:R.names[z.object]}),e&&Object(f.jsxs)("div",{className:"bg-white p-1 inline-block",children:[r.gene,":",r.residue,Object(f.jsx)("span",{className:"font-bold",style:{color:t},children:e})]}),Object(f.jsx)("div",{style:{color:"lineage"===r.variable?N(a):"inherit"},children:a}),Object(f.jsx)("div",{style:{color:"country"===r.variable?N(i):"inherit"},children:i}),o,Object(f.jsxs)("div",{className:"text-xs text-gray-600",children:[Object(f.jsx)("div",{className:"mt-1",children:Object(f.jsx)("b",{children:"Node mutations"})}),s?s.join(", "):Object(f.jsx)("i",{children:"No coding mutations"})]})]})}}),[n,R,z,r,$]),Se=Object(a.useMemo)((function(){return 0===R.ids.length}),[R]),Me=Object(a.useCallback)((function(e){var t=Object(s.a)(Object(s.a)({},B),{},{zoom:B.zoom+e,needs_update:!0}),n=Object(s.a)(Object(s.a)({},t),{},{target:[w(t),t.target[1]]});H({viewState:n,oldViewState:B})}),[B,H]);return Object(a.useEffect)((function(){if(null!==C.index){console.log(C);var e=Object(s.a)(Object(s.a)({},B),{},{zoom:19,needs_update:!0}),t=Object(s.a)(Object(s.a)({},e),{},{target:[w(e),R.y[y.filter((function(e){return e.original_index===C.index}))[0].data[0]]]});D(t)}}),[C]),Object(f.jsxs)("div",{className:"w-full h-full relative",onClick:Z,onPointerMove:Z,onPointerDown:Z,children:[" ",Object(f.jsxs)(u.a,{pickingRadius:10,onAfterRender:function(){(void 0===B.nw||B.needs_update)&&H({viewState:B})},ref:V,views:Ce,viewState:B,onViewStateChange:H,layerFilter:Object(a.useCallback)((function(e){var t=e.layer,n=e.viewport;return(t.id.startsWith("main")&&"main"===n.id||t.id.startsWith("mini")&&"minimap"===n.id)&(t.id.includes("mini")|B.zoom<8&!t.id.includes("fine")|B.zoom>8&!t.id.includes("coarse"))}),[B.zoom]),controller:!0,layers:we,children:[ke,Object(f.jsxs)("div",{style:{position:"absolute",right:"0.2em",bottom:"0.2em"},children:[Object(f.jsx)("button",{className:" w-12 h-10 bg-gray-100  p-1 rounded border-gray-300 text-gray-700 opacity-60 hover:opacity-100",onClick:function(){Me(.6)},children:Object(f.jsx)(p.b,{className:"mx-auto  w-5 h-5 "})}),Object(f.jsx)("button",{className:" w-12 h-10 bg-gray-100 ml-1 p-1 rounded border-gray-300 text-gray-700  opacity-60  hover:opacity-100",onClick:function(){Me(-.6)},children:Object(f.jsx)(p.c,{className:"mx-auto w-5 h-5 "})})]})]}),Se&&Object(f.jsx)(g,{isShown:!0,progress:i})]})},k=n(89),S=n(92),M=n(190);var T=function(e){var t,n=e.id,a=e.category,r=e.enabled,i=e.value,o=e.setThis,s=e.removeItem,c=e.index,l=e.searchColors,u=e.numResultsHere,d=e.zoomToMe,b=e.aa_pos,m=e.aa_final,j=e.aa_gene,h=e.all_genes,g=e.min_tips,x=e.search_for_ids,O=e.current_accession,v=l[c%l.length];return Object(f.jsxs)("div",{className:"border-gray-100 border-b mb-3 pb-3",children:[Object(f.jsx)("input",{name:"isGoing",type:"checkbox",style:{outline:r&&(i.length>0||!["name","lineage","country"].includes(a))?"1px solid rgb(".concat(v[0],",").concat(v[1],",").concat(v[2],")"):"0px",outlineOffset:"2px"},className:"w-3 h-3 m-3",checked:r,onChange:function(e){return o({enabled:!r})}}),Object(f.jsxs)("select",{className:" w-36 border py-2 px-1 text-grey-darkest text-sm h-10",value:a,onChange:function(e){return o({category:e.target.value})},children:[Object(f.jsx)("option",{value:"name",children:"Sequence name"}),Object(f.jsx)("option",{value:"lineage",children:"Lineage"}),Object(f.jsx)("option",{value:"country",children:"Country"}),Object(f.jsx)("option",{value:"mutation",children:"AA mutation"}),Object(f.jsx)("option",{value:"genbanks",children:"GenBank ids"})]}),["mutation","epis","genbanks"].includes(a)&&Object(f.jsx)("button",{className:"  bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border  text-gray-700 ml-8 h-8",onClick:function(){return s(n)},children:Object(f.jsx)(k.c,{className:"inline-block "})}),("epis"===a||"genbanks"===a)&&Object(f.jsxs)("div",{children:[Object(f.jsx)(S.DebounceInput,{className:"w-48 h-32 border p-1 m-1",element:"textarea",value:x,onChange:function(e){return o({search_for_ids:e.target.value})}}),Object(f.jsx)("br",{}),Object(f.jsxs)("div",{className:"h-10",children:[O&&Object(f.jsxs)("button",{onClick:function(e){return o({search_for_ids:""===x?O:x+"\n"+O})},className:" bg-gray-100  mx-auto p-1 rounded border-gray-300 border  text-gray-700 ml-2 h-6 text-xs",children:[Object(f.jsx)(M.a,{className:"inline mr-2 "}),"Add selected node"]})," "]})]}),"mutation"===a&&Object(f.jsxs)("div",{className:" p-2 m-2 ml-2  text-gray-700",children:[" ",Object(f.jsx)("label",{className:"text-sm",children:"Gene:"}),Object(f.jsx)("select",{className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-20 m-3 my-1",value:j,onChange:function(e){return o({aa_gene:e.target.value})},children:h&&h.map((function(e){return Object(f.jsx)("option",{value:e,children:e},e)}))}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{className:"text-sm",children:"Mutation at residue:"})," ",Object(f.jsx)(S.DebounceInput,{debounceTimeout:300,type:"number",value:b,onChange:function(e){return o({aa_pos:e.target.value})},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-20 m-3 my-1",placeholder:"e.g. 681"})," ",Object(f.jsx)("label",{className:"text-sm",children:" to"}),Object(f.jsx)("select",{value:m,onChange:function(e){return o({aa_final:e.target.value})},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-16 m-3 my-1",children:["any","A","C","D","E","F","G","H","I","J","K","L","M","N","P","Q","R","S","T","U","V","W","Y"].map((function(e){return Object(f.jsx)("option",{value:e,children:e},e)}))}),Object(f.jsx)("br",{}),Object(f.jsx)("label",{className:"text-sm",children:"Min descendant genomes:"}),Object(f.jsx)(S.DebounceInput,{debounceTimeout:300,value:g,type:"number",onChange:function(e){return o({min_tips:parseInt(e.target.value)})},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-16 m-3 my-1"})]})]}),["name","lineage","country"].includes(a)&&Object(f.jsx)(S.DebounceInput,{className:" w-32 border py-2 px-3 text-grey-darkest h-10",value:i,onChange:function(e){return o({value:e.target.value})},debounceTimeout:300}),["mutation","epis","genbanks"].includes(a)?Object(f.jsx)(f.Fragment,{}):Object(f.jsx)("button",{className:" bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border  text-gray-700 ml-2 h-8",onClick:function(){return s(n)},children:Object(f.jsx)(k.c,{className:"inline-block "})}),Object(f.jsx)("div",{className:"text-sm text-gray-600 px-3",children:{name:"Enter a sequence name like QEUH-13ADA01",lineage:"Enter a PANGO lineage like B.1.1.7. Note that sub-lineages will not be found by this method.",country:"Enter a country like 'India' ",mutation:"Enter an amino acid mutation. E.g. gene S, position 681, to R. Note that this will identify the internal node at which the mutation occurred, rather than all the leaf nodes with the mutation."}[a]}),Object(f.jsxs)("div",{className:"text-sm text-gray-900 px-3",children:[" ",(i.length>0||"mutation"===a||"epis"===a||"genbanks"===a)&&Object(f.jsxs)(f.Fragment,{children:[" ",(t=u,new Intl.NumberFormat("en-US").format(t))," result",1!==u&&Object(f.jsx)(f.Fragment,{children:"s"})]}),1===u&&r&&Object(f.jsxs)(f.Fragment,{children:[" ",Object(f.jsxs)("button",{onClick:d,className:"inline-block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-1 text-gray-700",children:[Object(f.jsx)(p.b,{className:"inline-block mr-1"}),"locate"]})]})]})]})},I=n(191),R=n(192),A=n(153);!function(e){if(e.length>4)e.slice(-4,-2),e.slice(-2)}("");var P=function(e){var t=e.searchItems,n=e.setSearchItems,r=e.colourBy,i=e.setColourBy,l=e.selectedNode,u=e.data,d=e.searchColors,b=e.numSearchResults,m=e.totalSeqs,j=e.setZoomToSearch,h=e.showMutText,g=e.setShowMutText,x=u.node_data,O=Object(a.useState)("colour"),v=Object(c.a)(O,2),y=v[0],_=v[1],N=Object(a.useMemo)((function(){if(l){var e=x.genbanks[l];if(e&&"nan"!==e)return e}return""}),[x,l]),w=Object(a.useMemo)((function(){if(l){var e=x.epi_isl_numbers[l];if(e&&0!==e)return"EPI_ISL_"+e}return""}),[x,l]);Object(a.useEffect)((function(){}),[w]);var C,M=Object(a.useMemo)((function(){if(!l)return[];for(var e=l,t={};e!==x.parents[e];){var n=x.mutations[e].mutation?Object.fromEntries(x.mutations[e].mutation.map((function(e){var t=u.mutation_mapping[e];return[t.gene+":"+t.position,t.final_res]}))):{};t=Object(s.a)(Object(s.a)({},n),t),e=x.parents[e]}return Object.entries(t).map((function(e){return e[0]+e[1]})).sort()}),[u,x,l]);return Object(f.jsxs)("div",{className:"overflow-y-auto",style:{height:"calc(100vh - 5em)"},children:[Object(f.jsxs)("div",{className:" border-t md:border-t-0 border-b border-gray-300",children:[Object(f.jsxs)("div",{className:"mt-3 mb-3 text-gray-500 text-sm",children:["Displaying ",(C=m,new Intl.NumberFormat("en-US").format(C))," sequences from INSDC, COG-UK and CNCB"]}),Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)(I.a,{className:"inline-block mr-2"}),"Search"]}),t.map((function(e,a){return Object(f.jsx)(T,{numResultsHere:b[a],searchColors:d,index:a,id:e.id,search_for_ids:e.search_for_ids,category:e.category,aa_gene:e.aa_gene,aa_pos:e.aa_pos,aa_final:e.aa_final,all_genes:u.all_genes,min_tips:e.min_tips,value:e.value,setThis:function(e){t[a]=Object(s.a)(Object(s.a)({},t[a]),e),n(Object(o.a)(t))},zoomToMe:function(){console.log(a),j({index:a})},removeItem:function(e){n(t.filter((function(t){return t.id!==e})))},enabled:e.enabled,current_accession:"genbanks"===e.category&&N?N:"epis"===e.category&&w?w:""},e.id)})),Object(f.jsxs)("button",{className:"block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-5 text-gray-700",onClick:function(){return n([].concat(Object(o.a)(t),[{id:Math.random(),category:"name",value:"",enabled:!0,aa_final:"any",min_tips:1,aa_gene:"S",search_for_ids:""}]))},children:[Object(f.jsx)(R.a,{className:"inline-block mr-2"}),"Add a new search"]})]}),"other"===y&&Object(f.jsxs)("div",{className:"border-b border-gray-300 pb-3",children:[Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)("button",{onClick:function(){return _("colour")},className:"float-right mr-5 block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-5 text-gray-700",children:Object(f.jsx)(p.a,{className:"inline-block mr-1 ml-1"})}),Object(f.jsx)(A.a,{className:"inline-block mr-2"}),"Other settings"," "]}),"Show mutation text"," ",Object(f.jsx)("input",{type:"checkbox",checked:h,onChange:function(e){console.log(h),g(!h)}}),Object(f.jsx)("div",{className:"text-sm text-gray-500 p-5",children:"Mutations are only shown at nodes with at least 10 descendant genomes"})]}),"colour"===y&&Object(f.jsxs)("div",{className:"border-b border-gray-300 pb-3",children:[Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)("button",{onClick:function(){return _("other")},className:"float-right mr-5 block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-5 text-gray-700",children:Object(f.jsx)(A.a,{className:"inline-block mr-1 ml-1"})}),Object(f.jsx)(p.a,{className:"inline-block mr-2"}),"Colour by"," "]}),Object(f.jsxs)("select",{className:"border py-2 px-3 text-grey-darkest",value:r.variable,onChange:function(e){return i(Object(s.a)(Object(s.a)({},r),{},{variable:e.target.value}))},children:[Object(f.jsx)("option",{value:"lineage",children:"Lineage"}),Object(f.jsx)("option",{value:"country",children:"Country"}),Object(f.jsx)("option",{value:"aa",children:"Amino acid at site"}),Object(f.jsx)("option",{value:"none",children:"None"})]}),"aa"===r.variable&&Object(f.jsxs)("div",{className:" p-2 m-1 ml-0  text-gray-700",children:[" ",Object(f.jsx)("label",{className:"text-sm",children:"Gene"}),Object(f.jsx)("select",{className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-20 m-3 my-1",value:r.gene,onChange:function(e){return i(Object(s.a)(Object(s.a)({},r),{},{gene:e.target.value}))},children:u.all_genes&&u.all_genes.map((function(e){return Object(f.jsx)("option",{value:e,children:e},e)}))}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{className:"text-sm",children:"Residue"})," ",Object(f.jsx)(S.DebounceInput,{debounceTimeout:300,type:"number",value:r.residue,onChange:function(e){return i(Object(s.a)(Object(s.a)({},r),{},{residue:e.target.value}))},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-16 m-3 my-1"})]}),Object(f.jsxs)("div",{className:"hidden",children:["Colour lines"," ",Object(f.jsx)("input",{type:"checkbox",value:r.colourLines,onChange:function(e){return i(Object(s.a)(Object(s.a)({},r),{},{colourLines:e.target.value}))}})]})]})]}),Object(f.jsx)("div",{children:l&&Object(f.jsxs)("div",{className:"text-gray-500 mr-3",children:[Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)(k.a,{className:"inline-block mr-2"}),"Node info"]}),Object(f.jsx)("div",{className:"font-bold",children:x.names[l]?x.names[l]:Object(f.jsx)(f.Fragment,{children:"Un-named internal node"})}),N&&Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Genbank:"})," ",Object(f.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline",href:"https://www.ncbi.nlm.nih.gov/nuccore/"+N,children:N})]}),Object(f.jsx)("div",{children:!1}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Date:"})," ",u.date_mapping[x.dates[l]]]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Lineage:"})," ",Object(f.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:"https://outbreak.info/situation-reports?pango="+u.lineage_mapping[x.lineages[l]],children:u.lineage_mapping[x.lineages[l]]})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Country:"})," ",u.country_mapping[x.countries[l]]]}),Object(f.jsx)("span",{className:"font-semibold",children:"Mutations from root:"}),Object(f.jsx)("div",{className:"text-xs mr-5 mb-3",children:M&&M.join(", ")}),!1]})})]})},z=n(193),E=n.n(z);var L=function(e){var t=e.enabled,n=e.setEnabled;return Object(f.jsxs)("div",{className:"w-full ".concat(t?"":"hidden"),children:[Object(f.jsx)("div",{onClick:function(){return n(!1)},className:"fixed w-full h-full bg-black opacity-80 z-40"}),Object(f.jsxs)("div",{onClick:function(){return n(!1)},className:"fixed w-full h-full  opacity-100 z-40",children:[Object(f.jsxs)("div",{className:" relative mx-auto mt-5 p-5 bg-white shadow-md z-100 w-4/5 overflow-y-auto opacity-100 ",style:{height:"90vh"},children:[Object(f.jsx)("button",{className:"absolute top-5 right-5 text-xl font-bold",onClick:function(){return n(!1)},children:"X"}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl",children:"About Cov2Tree"}),"This website allows you to explore a phylogenetic tree with more than a million SARS-Cov-2 sequences, sequenced by researchers around the world. The interface was made by"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"http://theo.io/",children:"Theo Sanderson"})," ","using a custom-developed open-source library called"," ",Object(f.jsxs)("a",{href:"http://github.com/theosanderson/taxodium",className:"text-blue-700 underline",children:[" ","Taxodium"]}),".",Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-6",children:"The sequences"}),Object(f.jsxs)("p",{children:["This tree displays sequences generated by scientists all over the world. The sequences are sourced from GenBank (i.e. the INSDC databases), the China National Center for Bioinformation, and from COG-UK. They are collated"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2//",children:"here"})," ","by Angie Hinrichs and others at UCSC."]}),Object(f.jsx)("p",{children:"This website would be empty but for the hard work of all these researchers, and their openness in submitting their work to public databases, and we gratefully acknowledge this."}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-6",children:"The tree"}),Object(f.jsxs)("p",{children:["The tree shown here is produced by the UCSC team, and made available"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2//",children:"here"}),". It is derived from releases of Rob Lanfear's"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://github.com/roblanf/sarscov2phylo",children:"sarscov2phylo"}),", pruned to include only public sequences aggregated from GenBank, COG-UK, and the China National Center for Bioinformation. The tree has been re-rooted to Wuhan/Hu-1 (GenBank MN908947.3, RefSeq NC_045512.2), and nodes with no associated mutations have been collapsed. Sequences released after the final sarscov2phylo release (Nov. 13, 2020) have been added to the tree using"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://github.com/yatisht/usher",children:"UShER"}),", developed by Yatish Turakhia. UShER development and tree inference was done in Russ Corbett-Detig and David Haussler's groups at the UCSC Genomics Institute. It is described here only for completeness. UCSC provide metadata with the sequences, including lineages called by"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://www.pango.network/",children:"Pangolin"}),"."]}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-4",children:"Citations"}),Object(f.jsxs)("div",{className:"text-sm",children:[Object(f.jsx)("p",{children:"Lanfear, Rob (2020). A global phylogeny of SARS-CoV-2 sequences from GISAID. Zenodo DOI: 10.5281/zenodo.3958883"}),Object(f.jsx)("p",{children:"Turakhia et al. (2021). Ultrafast Sample Placement on Existing Trees (UShER) Empowers Real-Time Phylogenetics for the SARS-CoV-2 Pandemic."}),Object(f.jsx)("p",{children:"Rambaut et al. (2020). A dynamic nomenclature proposal for SARS-CoV-2 lineages to assist genomic epidemiology."})]}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-4",children:"Related tools"}),Object(f.jsx)("div",{className:"text-sm",children:Object(f.jsxs)("p",{children:["You can also explore large phylogenies using"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://pando.tools",children:"Pando"}),","," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://microreact.org/",children:"Microreact"}),", and sampled phylogenies on"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://nextstrain.org/",children:"NextStrain"}),"."]})})]})," "]})]})},U=n(195),B=n(36),D=function(e){return"?"+Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")},F=function(e){for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var r=Object(c.a)(a[n],2),i=r[0],o=r[1];void 0!==o&&(t[i]=encodeURIComponent(o))}return t},W=function(e){var t=Object(B.d)(),n=Object(B.e)(),r=n.pathname,i=n.search,o=Object(a.useMemo)((function(){return function(e){var t={};return new URLSearchParams(e).forEach((function(e,n){t[n]=e})),t}(i)}),[i]),l=Object(a.useRef)({decodedSearch:o,pathname:r});Object(a.useEffect)((function(){l.current={decodedSearch:o,pathname:r}}),[o,r]);var u=Object(a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"push",a=l.current,r=a.pathname,i=a.decodedSearch;t[n](r+D(F(Object(s.a)(Object(s.a)({},i),e))))}),[t]);return[Object(a.useMemo)((function(){return Object.assign({},e,function(e){for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var r=Object(c.a)(a[n],2),i=r[0],o=r[1];void 0!==o&&(t[i]=o)}return t}(o))}),[o,e]),u]},G=n(241);G.parse.defaults.keepCase=!0;var q=[[255,0,0],[183,0,255],[255,213,0],[0,0,255],[0,255,255]];var V=function(){var e=Object(a.useState)({index:null}),t=Object(c.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),l=Object(c.a)(i,2),u=l[0],d=l[1];console.log("M2",u);var b=W({search:JSON.stringify([{id:.123,category:"lineage",value:"",enabled:!0,aa_final:"any",min_tips:1,aa_gene:"S",search_for_ids:""}]),colourBy:JSON.stringify({variable:"lineage",gene:"S",colourLines:!1,residue:"681"})}),m=Object(c.a)(b,2),j=m[0],h=m[1],g=Object(a.useMemo)((function(){return JSON.parse(j.search)}),[j.search]),p=Object(a.useCallback)((function(e){h(Object(s.a)(Object(s.a)({},j),{},{search:JSON.stringify(e)}))}),[h,j]),x=Object(a.useCallback)((function(e){h(Object(s.a)(Object(s.a)({},j),{},{colourBy:JSON.stringify(e)}))}),[h,j]),O=Object(a.useMemo)((function(){return JSON.parse(j.colourBy)}),[j.colourBy]),v=Object(a.useCallback)((function(e){x(e)}),[x]),y=Object(a.useState)({status:"not_attempted",data:{node_data:{ids:[]}}}),_=Object(c.a)(y,2),N=_[0],w=_[1],S=Object(a.useState)(null),M=Object(c.a)(S,2),T=M[0],I=M[1],R=Object(a.useState)(!1),A=Object(c.a)(R,2),z=A[0],B=A[1];Object(a.useEffect)((function(){"not_attempted"===N.status&&(console.log("starting dl"),w({status:"loading",progress:0,data:{node_data:{ids:[]}}}),G.load("./tree.proto").then((function(e){E.a.get("/nodelist.pb",{responseType:"arraybuffer",onDownloadProgress:function(e){var t=Math.floor(e.loaded/1e8*1*100);w({status:"loading",progress:t,data:{node_data:{ids:[]}}})}}).then((function(e){return e.data})).then((function(t){console.log("buffer loaded");var n=e.lookupType("AllData"),a=n.decode(new Uint8Array(t)),r=n.toObject(a);r.node_data.ids=Object(o.a)(Array(r.node_data.x.length).keys());var i=new Set;r.mutation_mapping=r.mutation_mapping.map((function(e,t){var n={},a=e.split(":"),r=Object(c.a)(a,2),o=r[0],s=r[1];if(s){var l=s.split("_"),u=Object(c.a)(l,3),d=u[0],b=u[1],m=u[2];n.gene=o,n.position=b,n.orig_res=d,n.final_res=m,i.add(o)}return n.id=t,n})),r.all_genes=Array.from(i).sort(),w({status:"loaded",data:r})}))})))}),[N.status]);var D=Object(a.useMemo)((function(){return"loaded"===N.status?N.data:{node_data:{ids:[]}}}),[N]),F=Object(a.useMemo)((function(){return D.node_data.ids.filter((function(e){return""!==D.node_data.names[e]}))}),[D]),V=Object(a.useMemo)((function(){var e=g.map((function(e,t){var n;window.nd=D.node_data;var a=e.value.toLowerCase().trim();if("mutation"===e.category){window.mm=D.mutation_mapping;var r=D.mutation_mapping?D.mutation_mapping.filter((function(t){return t.gene===e.aa_gene&&t.position===e.aa_pos&&t.final_res===e.aa_final|"any"===e.aa_final})).map((function(e){return e.id})):[];console.log(r),n=function(t){return D.node_data.mutations[t]&&D.node_data.mutations[t].mutation&&r.filter((function(e){return D.node_data.mutations[t].mutation.includes(e)})).length>0&&D.node_data.num_tips[t]>=e.min_tips&&D.node_data.parents[t]!==t}}if("name"===e.category&&(n=function(e){return D.node_data.names[e].toLowerCase().includes(a)}),"country"===e.category&&(n=function(e){return D.country_mapping[D.node_data.countries[e]].toLowerCase()===a}),"lineage"===e.category&&(n=function(e){return D.lineage_mapping[D.node_data.lineages[e]].toLowerCase()===a}),"epis"===e.category)if(console.log("EPI"),e.search_for_ids){var i=e.search_for_ids.split("\n").map((function(e){return parseInt(e.trim().replace("EPI_ISL_",""))})).filter((function(e){return 0!==e}));n=function(e){return i.includes(D.node_data.epi_isl_numbers[e])}}else n=function(e){return!1};if("genbanks"===e.category)if(e.search_for_ids){var o=e.search_for_ids.split("\n").map((function(e){return e.trim()})).filter((function(e){return""!==e}));n=function(e){return o.includes(D.node_data.genbanks[e])}}else n=function(e){return!1};var s=("mutation"===e.category||"epis"===e.category||"genbanks"===e.category||null!==e.value&&""!==e.value)&&e.enabled;return{original_index:t,id:"main-search-"+t,enabled:s,data:""!==e.value|("mutation"===e.category||"epis"===e.category||"genbanks"===e.category)?D.node_data.ids.filter(n):[],opacity:.7,getRadius:7+2*t,filled:!1,stroked:!0,radiusUnits:"pixels",lineWidthUnits:"pixels",lineWidthScale:1,getPosition:function(e){return[D.node_data.x[e],D.node_data.y[e]]},getFillColor:function(e){return[0,0,0]},getLineColor:function(e){return q[t%q.length]}}})),t=e.map((function(e){return e.data.length}));return[e.filter((function(e){return e.enabled})),t,F.length]}),[D,g,F]),H=Object(c.a)(V,3),J=H[0],K=H[1],Y=H[2];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(L,{enabled:z,setEnabled:B}),Object(f.jsxs)("div",{className:"h-screen w-screen",children:[Object(f.jsx)("div",{className:"from-gray-500 to-gray-600 bg-gradient-to-bl h-15 shadow-md z-20",children:Object(f.jsxs)("div",{className:"flex justify-between",children:[Object(f.jsxs)("h1",{className:"text-xl p-4  pb-5 text-white ",children:[Object(f.jsx)(U.a,{className:"inline-block h-8 w-8 pr-2 "}),Object(f.jsx)("span",{className:"font-bold",children:"Cov2Tree"}),":"," ",Object(f.jsxs)("span",{className:"font-light",children:["interactive SARS-CoV-2 phylogeny"," "]})]}),Object(f.jsx)("div",{className:"inline-block p-4 pr-0",children:Object(f.jsxs)("button",{onClick:function(){return B(!0)},className:"mr-5 text-white font-bold hover:underline",children:[Object(f.jsx)(k.b,{className:"inline-block h-7 w-8"})," About / Acknowledgements"]})})]})}),Object(f.jsx)("div",{className:"main_content",children:Object(f.jsxs)("div",{className:"md:grid md:grid-cols-12 h-full",children:[Object(f.jsx)("div",{className:"md:col-span-8 h-3/6 md:h-full w-full",children:Object(f.jsx)(C,{showMutText:u,search_configs_initial:J,scatterIds:F,searchColors:q,selectedNode:T,setSelectedNode:I,searchItems:g,data:D,progress:N.progress,colourBy:O,zoomToSearch:n})}),Object(f.jsx)("div",{className:"md:col-span-4 h-full bg-white  border-gray-600   pl-5 shadow-xl",children:Object(f.jsx)(P,{showMutText:u,setShowMutText:d,setZoomToSearch:r,totalSeqs:Y,numSearchResults:K,searchColors:q,selectedNode:T,searchItems:g,data:D,setSearchItems:p,colourBy:O,setColourBy:v})})]})})]})]})},H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,282)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))},J=n(149);i.a.render(Object(f.jsx)(J.a,{children:Object(f.jsx)(V,{})}),document.getElementById("root")),H()}},[[259,1,2]]]);
//# sourceMappingURL=main.e426e470.chunk.js.map