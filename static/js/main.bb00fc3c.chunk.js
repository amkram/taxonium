(this.webpackJsonptaxodium=this.webpackJsonptaxodium||[]).push([[0],{152:function(e,t){},207:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){},211:function(e,t){},257:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n(184),o=n.n(r),i=(n(207),n(57)),c=n(17),s=n(42),l=(n(208),n(120)),u=n(270),d=n(272),b=n(277),m=n(278),j=n(273),h=n(279),f=(n(209),n(5));var g=function(e){var t=e.isShown,n=e.progress;return t?Object(f.jsxs)("div",{className:"w-full h-full fixed bg-white text-center",children:[" ",Object(f.jsx)("div",{className:"loader z-50",children:"Loading..."}),Object(f.jsxs)("div",{className:"text-black",children:["Loading ",n,"%"]})]}):Object(f.jsx)(f.Fragment,{})},p=n(88);function x(e,t,n,a){var r=Object(c.a)(Object(c.a)({},e),{},{data:O(e.data,t,n,a),visible:!0,id:e.id+"_coarse"}),o=function(e){return Object(c.a)(Object(c.a)({},e),{},{id:e.id.replace("main","mini"),lineWidthScale:1,pickable:!1,getRadius:e.id.includes("search")?.5*e.getRadius:e.getRadius})}(r);return[r,Object(c.a)(Object(c.a)({},e),{},{visible:!0,id:e.id+"_fine"}),o]}function O(e,t,n,a){var r={};return e.filter((function(e){if(a&&Math.abs(t.x[e]-t.x[t.parents[e]])>1|Math.abs(t.y[e]-t.y[t.parents[e]])>.5)return!0;var o=Math.round(t.x[e]*n)/n,i=Math.round(t.y[e]*n)/n;return r[o]?!r[o][i]&&(r[o][i]=1,!0):(r[o]=Object(l.a)({},i,1),!0)}))}var v=[{contour:[[-100,-100],[-100,100],[100,100],[100,-100]],zipcode:94107,population:26599,area:6.11}],y={};function w(e){if(y[e])return y[e];var t=function(e){var t={A:[230,25,75],R:[60,180,75],N:[255,225,25],D:[67,99,216],C:[245,130,49],Q:[70,240,240],E:[145,30,180],G:[240,50,230],H:[188,246,12],I:[250,190,190],L:[230,0,255],K:[0,128,128],M:[154,99,36],F:[255,250,200],P:[128,0,0],T:[170,255,195],W:[128,128,0],Y:[0,0,117],V:[0,100,177],X:[128,128,128],O:[255,255,255],Z:[0,0,0]};if(t[e])return t[e];if(void 0===e)return[200,200,200];if("unknown"===e)return[200,200,200];if("USA"===e)return[95,158,245];if("England"===e)return[214,58,15];if("Scotland"===e)return[255,130,82];if("Wales"===e)return[148,49,22];if("Northern Ireland"===e)return[140,42,15];if("France"===e)return[140,28,120];if("Germany"===e)return[106,140,28];if("India"===e)return[61,173,166];if("Denmark"===e)return[24,112,32];e=e.split("").reverse().join("");var n=0;if(0===e.length)return n;for(var a=0;a<e.length;a++)n=e.charCodeAt(a)+((n<<5)-n),n&=n;var r=[0,0,0];for(a=0;a<3;a++){var o=n>>8*a&255;r[a]=o}if(r[0]+r[1]+r[2]<150||r[0]+r[1]+r[2]>500)return w(e+"_");return r}(e);return y[e]=t,t}function N(e){var t=w(e);return"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")")}var _=function(e){return 7/Math.pow(2,e.zoom-5.6)};var C=function(e){var t=e.data,n=e.colourBy,r=e.progress,o=e.setSelectedNode,l=e.scatterIds,O=e.search_configs_initial,y=e.zoomToSearch,C=Object(a.useState)({ids:[],top:0,bottom:0}),S=Object(s.a)(C,2),k=S[0],M=S[1],T=t.node_data,R=Object(a.useState)(),I=Object(s.a)(R,2),A=I[0],z=I[1],P=Object(a.useState)({zoom:4.7,target:[6,13]}),E=Object(s.a)(P,2),U=E[0],L=E[1],D=Object(a.useState)(0),F=Object(s.a)(D,2),B=F[0],W=(F[1],Object(a.useMemo)((function(){return[1/Math.pow(2,U.zoom-B-5.6),0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}),[U.zoom,B])),G=Object(a.useRef)(null),q=Object(a.useCallback)((function(e){var t=e.viewId,n=e.viewState;e.oldViewState;if("minimap"!==t&&(n.minimap={zoom:3,target:[5,13]},n.target[0]=_(n),G.current.viewports.length)){var a=G.current.viewports[0],r=a.unproject([0,0,0]),o=a.unproject([a.width,a.height,0]);o[0]=o[0]*Math.pow(2,n.zoom-6),r[0]=r[0]*Math.pow(2,n.zoom-6),n=Object(c.a)(Object(c.a)({},n),{},{nw:r,se:o,needs_update:!1}),r[0]=-500,o[0]=500,L(n)}}),[G,B]),V=Object(a.useState)(!1),H=Object(s.a)(V,2),J=H[0],K=H[1],Y=Object(a.useCallback)((function(e){if(0===e.buttons&&"onPointerMove"===e._reactName)return!1;var t=G.current.pickObject({x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY,radius:10});if("onPointerDown"===e._reactName&&(t&&"minimap"===t.viewport.id?K(!0):K(!1)),t&&"main"===t.viewport.id&&"onClick"===e._reactName&&o(t.object),t||"onClick"!==e._reactName||o(null),t&&"minimap"===t.viewport.id&&J){var n=Object(c.a)(Object(c.a)({},U),{},{target:[_(U),t.coordinate[1]],needs_update:!0});q({viewState:n,oldViewState:U})}}),[U,J,o,q]),X=Object(a.useMemo)((function(){return new d.a({id:"mini-poly-layer",data:v,pickable:!0,stroked:!0,opacity:.5,filled:!0,wireframe:!0,getPolygon:function(e){return e.contour},getFillColor:function(e){return[240,240,240]},getLineColor:[80,80,80],getLineWidth:1,lineWidthUnits:"pixels"})}),[]),Z=Object(a.useMemo)((function(){var e={};console.log(n);return function(n,a,r){for(var o=n,i=[],c=function(){var n=null;i.push(o);var c=void 0;if(e[o]?n=e[o]:((c=T.mutations[o].mutation&&T.mutations[o].mutation.filter((function(e){return t.mutation_mapping[e].gene===a&&t.mutation_mapping[e].position===r})))&&1===c.length&&(console.log(null),n=t.mutation_mapping[c[0]].final_res),T.parents[o]===o&&null==n&&(n="X")),n)return i.forEach((function(t){e[t]=n})),{v:n};o=T.parents[o]};;){var s=c();if("object"===typeof s)return s.v}}}),[T,t,n]),Q=Object(a.useMemo)((function(){return{data:l.filter((function(){return!0})),visible:!0,opacity:.6,getRadius:3,radiusUnits:"pixels",id:"main-scatter",pickable:!0,getLineColor:[100,100,100],lineWidthUnits:"pixels",lineWidthScale:1,onHover:function(e){return z(e)},getPosition:function(e){return[T.x[e],T.y[e]]},getFillColor:function(e){return"lineage"===n.variable?w(t.lineage_mapping[T.lineages[e]]):"country"===n.variable?w(t.country_mapping[T.countries[e]]):"aa"===n.variable?w(Z(e,n.gene,n.residue)):[200,200,200]}}}),[l,T,t,n,Z]),$=Object(a.useMemo)((function(){return x(Q,T,100)}),[Q,T]),ee=Object(a.useMemo)((function(){return $.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:W,stroked:e.id.includes("mini")?void 0:U.zoom>15,radiusMaxPixels:e.id.includes("mini")?2:U.zoom>15?U.zoom/5:3})}))}),[$,U,W]),te=Object(a.useMemo)((function(){return ee.map((function(e){return new b.a(e)}))}),[ee]),ne=Object(a.useMemo)((function(){var e;return(e=[]).concat.apply(e,Object(i.a)(O.map((function(e){return x(e,T,100)}))))}),[O,T]),ae=Object(a.useMemo)((function(){return ne.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:W})}))}),[ne,W]),re=Object(a.useMemo)((function(){return ae.map((function(e){return new b.a(e)}))}),[ae]),oe=Object(a.useMemo)((function(){return{id:"main-line",data:T.ids.filter((function(e){return!0})),getWidth:1,pickable:!0,onHover:function(e){return z(e)},getTargetPosition:function(e){return[T.x[T.parents[e]],T.y[e]]},getSourcePosition:function(e){return[T.x[e],T.y[e]]},getColor:"aa"===n.variable&&n.colourLines?function(e){return w(Z(e,n.gene,n.residue))}:[150,150,150]}}),[T,n,Z]),ie=Object(a.useMemo)((function(){return{id:"main-line-2",data:T.ids.filter((function(e){return!0})),pickable:!1,getWidth:1,getTargetPosition:function(e){return[T.x[T.parents[e]],T.y[T.parents[e]]]},getSourcePosition:function(e){return[T.x[T.parents[e]],T.y[e]]},getColor:"aa"===n.variable&&n.colourLines?function(e){return w(Z(e,n.gene,n.residue))}:[150,150,150]}}),[T,n,Z]),ce=Object(a.useMemo)((function(){return[].concat.apply([],[oe,ie].map((function(e){return x(e,T,100,!0)})))}),[oe,ie,T]),se=Object(a.useMemo)((function(){return ce.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{modelMatrix:e.id.includes("mini")?void 0:W})}))}),[ce,W]),le=Object(a.useMemo)((function(){return se.map((function(e){return new m.a(e)}))}),[se]);if(U.zoom>17&&!0!==U.needs_update)if(U.nw[1]>k.top&U.se[1]<k.bottom);else{var ue=U.nw[1],de=U.se[1],be=de-ue,me=ue-4*be,je=de+4*be,he=l.filter((function(e){return T.y[e]>me&T.y[e]<je}));M({top:me,bottom:je,ids:he})}var fe=Object(a.useMemo)((function(){return{id:"main-text-layer",data:k.ids,getPosition:function(e){return[T.x[e]+.3,T.y[e]]},getText:function(e){return T.names[e]},getColor:[180,180,180],getAngle:0,billboard:!0,getTextAnchor:"start",getAlignmentBaseline:"center"}}),[T,k]),ge=Object(a.useMemo)((function(){return[new j.a(Object(c.a)(Object(c.a)({},fe),{},{visible:U.zoom>18.5,getSize:U.zoom>19?12:9.5,modelMatrix:W}))]}),[fe,W,U]),pe=Object(a.useMemo)((function(){var e;return e=void 0!==U.nw?[{contour:[[-100,-100],[100,-100],[100,U.nw[1]],[-100,U.nw[1]]],color:[100,100,100]},{contour:[[-100,U.nw[1]],[100,U.nw[1]],[100,U.se[1]],[-100,U.se[1]]],color:[255,255,255]},{contour:[[-100,U.se[1]],[100,U.se[1]],[100,300],[-100,300]],color:[150,150,150]}]:[],new d.a({id:"mini-pos",data:e,opacity:.05,radiusMinPixels:4,radiusMaxPixels:4,getRadius:4,getLineWidth:.1,getPolygon:function(e){return e.contour},getFillColor:function(e){return e.color}})}),[U]),xe=Object(a.useMemo)((function(){return[X].concat(Object(i.a)(ge),Object(i.a)(le),Object(i.a)(te),Object(i.a)(re),[pe])}),[X,ge,te,le,pe,re]);window.deck=G;var Oe=Object(a.useMemo)((function(){return[new h.a({id:"main",controller:!0}),new h.a({id:"minimap",x:"79%",y:"1%",width:"20%",height:"35%",borderWidth:"1px",controller:!0})]}),[]),ve=Object(a.useMemo)((function(){if(A&&A.object){var e,a,r=t.lineage_mapping[T.lineages[A.object]],o=t.country_mapping[T.countries[A.object]],i=t.date_mapping[T.dates[A.object]];"aa"===n.variable&&(a=N(e=Z(A.object,n.gene,n.residue)));var c=T.mutations[A.object]&&T.mutations[A.object].mutation&&T.mutations[A.object].mutation.map((function(e){var n=t.mutation_mapping[e];return n.gene+":"+n.orig_res+n.position+n.final_res})).sort();return Object(f.jsxs)("div",{className:"bg-gray-100 p-3 opacity-90 text-sm",style:{position:"absolute",zIndex:1,pointerEvents:"none",left:A.x,top:A.y},children:[Object(f.jsx)("h2",{className:"font-bold",children:T.names[A.object]}),e&&Object(f.jsxs)("div",{className:"bg-white p-1 inline-block",children:[n.gene,":",n.residue,Object(f.jsx)("span",{className:"font-bold",style:{color:a},children:e})]}),Object(f.jsx)("div",{style:{color:"lineage"===n.variable?N(r):"inherit"},children:r}),Object(f.jsx)("div",{style:{color:"country"===n.variable?N(o):"inherit"},children:o}),i,Object(f.jsx)("div",{className:"text-xs",children:c?c.join(", "):Object(f.jsx)("i",{children:"No coding mutations"})})]})}}),[t,T,A,n,Z]),ye=Object(a.useMemo)((function(){return 0===T.ids.length}),[T]),we=Object(a.useCallback)((function(e){var t=Object(c.a)(Object(c.a)({},U),{},{zoom:U.zoom+e,needs_update:!0}),n=Object(c.a)(Object(c.a)({},t),{},{target:[_(t),t.target[1]]});q({viewState:n,oldViewState:U})}),[U,q]);return Object(a.useEffect)((function(){if(null!==y.index){console.log(y);var e=Object(c.a)(Object(c.a)({},U),{},{zoom:19,needs_update:!0}),t=Object(c.a)(Object(c.a)({},e),{},{target:[_(e),T.y[O.filter((function(e){return e.original_index===y.index}))[0].data[0]]]});L(t)}}),[y]),Object(f.jsxs)("div",{className:"w-full h-full relative",onClick:Y,onPointerMove:Y,onPointerDown:Y,children:[" ",Object(f.jsxs)(u.a,{pickingRadius:10,onAfterRender:function(){(void 0===U.nw||U.needs_update)&&q({viewState:U})},ref:G,views:Oe,viewState:U,onViewStateChange:q,layerFilter:Object(a.useCallback)((function(e){var t=e.layer,n=e.viewport;return(t.id.startsWith("main")&&"main"===n.id||t.id.startsWith("mini")&&"minimap"===n.id)&(t.id.includes("mini")|U.zoom<8&!t.id.includes("fine")|U.zoom>8&!t.id.includes("coarse"))}),[U.zoom]),controller:!0,layers:xe,children:[ve,Object(f.jsxs)("div",{style:{position:"absolute",right:"0.2em",bottom:"0.2em"},children:[Object(f.jsx)("button",{className:" w-12 h-10 bg-gray-100  p-1 rounded border-gray-300 text-gray-700 opacity-60 hover:opacity-100",onClick:function(){we(.6)},children:Object(f.jsx)(p.b,{className:"mx-auto  w-5 h-5 "})}),Object(f.jsx)("button",{className:" w-12 h-10 bg-gray-100 ml-1 p-1 rounded border-gray-300 text-gray-700  opacity-60  hover:opacity-100",onClick:function(){we(-.6)},children:Object(f.jsx)(p.c,{className:"mx-auto w-5 h-5 "})})]})]}),ye&&Object(f.jsx)(g,{isShown:!0,progress:r})]})},S=n(89),k=n(103);var M=function(e){var t,n=e.id,a=e.category,r=e.enabled,o=e.value,i=e.setThis,c=e.removeItem,s=e.index,l=e.searchColors,u=e.numResultsHere,d=e.zoomToMe,b=e.aa_pos,m=e.aa_final,j=e.aa_gene,h=e.all_genes,g=e.min_tips,x=l[s%l.length];return Object(f.jsxs)("div",{className:"border-gray-100 border-b mb-3 pb-3",children:[Object(f.jsx)("input",{name:"isGoing",type:"checkbox",style:{outline:r&&o.length>0?"1px solid rgb(".concat(x[0],",").concat(x[1],",").concat(x[2],")"):"0px",outlineOffset:"2px"},className:"w-3 h-3 m-3",checked:r,onChange:function(e){return i({enabled:!r})}}),Object(f.jsxs)("select",{className:" w-36 border py-2 px-1 text-grey-darkest text-sm h-10",value:a,onChange:function(e){return i({category:e.target.value})},children:[Object(f.jsx)("option",{value:"name",children:"Sequence name"}),Object(f.jsx)("option",{value:"lineage",children:"Lineage"}),Object(f.jsx)("option",{value:"country",children:"Country"}),Object(f.jsx)("option",{value:"mutation",children:"AA mutation"})]}),"mutation"===a&&Object(f.jsx)("button",{className:"  bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border  text-gray-700 ml-8 h-8",onClick:function(){return c(n)},children:Object(f.jsx)(S.c,{className:"inline-block "})}),"mutation"===a&&Object(f.jsxs)("div",{className:" p-2 m-2 ml-2  text-gray-700",children:[" ",Object(f.jsx)("label",{className:"text-sm",children:"Gene:"}),Object(f.jsx)("select",{className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-20 m-3 my-1",value:j,onChange:function(e){return i({aa_gene:e.target.value})},children:h.map((function(e){return Object(f.jsx)("option",{value:e,children:e},e)}))}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{className:"text-sm",children:"Mutation at residue:"})," ",Object(f.jsx)(k.DebounceInput,{debounceTimeout:300,type:"number",value:b,onChange:function(e){return i({aa_pos:e.target.value})},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-20 m-3 my-1",placeholder:"e.g. 681"})," ",Object(f.jsx)("label",{className:"text-sm",children:" to"}),Object(f.jsx)("select",{value:m,onChange:function(e){return i({aa_final:e.target.value})},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-16 m-3 my-1",children:["any","A","C","D","E","F","G","H","I","J","K","L","M","N","P","Q","R","S","T","U","V","W","Y"].map((function(e){return Object(f.jsx)("option",{value:e,children:e},e)}))}),Object(f.jsx)("br",{}),Object(f.jsx)("label",{className:"text-sm",children:"Min descendant genomes:"}),Object(f.jsx)(k.DebounceInput,{debounceTimeout:300,value:g,type:"number",onChange:function(e){return i({min_tips:parseInt(e.target.value)})},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-16 m-3 my-1"})]})]}),"mutation"!==a&&Object(f.jsx)(k.DebounceInput,{className:" w-32 border py-2 px-3 text-grey-darkest h-10",value:o,onChange:function(e){return i({value:e.target.value})},debounceTimeout:300}),"mutation"===a?Object(f.jsx)(f.Fragment,{}):Object(f.jsx)("button",{className:" bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border  text-gray-700 ml-2 h-8",onClick:function(){return c(n)},children:Object(f.jsx)(S.c,{className:"inline-block "})}),Object(f.jsx)("div",{className:"text-sm text-gray-600 px-3",children:{name:"Enter a sequence name like QEUH-13ADA01",lineage:"Enter a PANGO lineage like B.1.1.7. Note that sub-lineages will not be found by this method.",country:"Enter a country like 'India' ",mutation:"Enter an amino acid mutation like a mutation in gene S at position 681 to R. Note that this will identify the internal node at which the mutation occurred, rather than all the leaf nodes with the mutation."}[a]}),Object(f.jsxs)("div",{className:"text-sm text-gray-900 px-3",children:[" ",(o.length>0||"mutation"===a)&&Object(f.jsxs)(f.Fragment,{children:[" ",(t=u,new Intl.NumberFormat("en-US").format(t))," result",1!==u&&Object(f.jsx)(f.Fragment,{children:"s"})]}),1===u&&r&&Object(f.jsxs)(f.Fragment,{children:[" ",Object(f.jsxs)("button",{onClick:d,className:"inline-block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-1 text-gray-700",children:[Object(f.jsx)(p.b,{className:"inline-block mr-1"}),"locate"]})]})]})]})},T=n(189),R=n(190);var I=function(e){var t,n=e.searchItems,r=e.setSearchItems,o=e.colourBy,s=e.setColourBy,l=e.selectedNode,u=e.data,d=e.searchColors,b=e.numSearchResults,m=e.totalSeqs,j=e.setZoomToSearch,h=u.node_data,g=Object(a.useMemo)((function(){if(!l)return[];for(var e=l,t={};e!==h.parents[e];){var n=h.mutations[e].mutation?Object.fromEntries(h.mutations[e].mutation.map((function(e){var t=u.mutation_mapping[e];return[t.gene+":"+t.position,t.final_res]}))):{};t=Object(c.a)(Object(c.a)({},n),t),e=h.parents[e]}return Object.entries(t).map((function(e){return e[0]+e[1]})).sort()}),[u,h,l]);return Object(f.jsxs)("div",{className:"overflow-y-auto",style:{height:"calc(100vh - 5em)"},children:[Object(f.jsxs)("div",{className:" border-t md:border-t-0 border-b border-gray-300",children:[Object(f.jsxs)("div",{className:"mt-3 mb-3 text-gray-500 text-sm",children:["Displaying ",(t=m,new Intl.NumberFormat("en-US").format(t))," sequences from INSDC, COG-UK and CNCB"]}),Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)(T.a,{className:"inline-block mr-2"}),"Search"]}),n.map((function(e,t){return Object(f.jsx)(M,{numResultsHere:b[t],searchColors:d,index:t,id:e.id,category:e.category,aa_gene:e.aa_gene,aa_pos:e.aa_pos,aa_final:e.aa_final,all_genes:u.all_genes,min_tips:e.min_tips,value:e.value,setThis:function(e){n[t]=Object(c.a)(Object(c.a)({},n[t]),e),r(Object(i.a)(n))},zoomToMe:function(){console.log(t),j({index:t})},removeItem:function(e){r(n.filter((function(t){return t.id!==e})))},enabled:e.enabled},e.id)})),Object(f.jsxs)("button",{className:"block bg-gray-100 text-sm mx-auto p-1 rounded border-gray-300 border m-5 text-gray-700",onClick:function(){return r([].concat(Object(i.a)(n),[{id:Math.random(),category:"name",value:"",enabled:!0,aa_final:"any",min_tips:1,aa_gene:"S"}]))},children:[Object(f.jsx)(R.a,{className:"inline-block mr-2"}),"Add a new search"]})]}),Object(f.jsxs)("div",{className:"border-b border-gray-300 pb-3",children:[Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)(p.a,{className:"inline-block mr-2"}),"Colour by"]}),Object(f.jsxs)("select",{className:"border py-2 px-3 text-grey-darkest",value:o.variable,onChange:function(e){return s(Object(c.a)(Object(c.a)({},o),{},{variable:e.target.value}))},children:[Object(f.jsx)("option",{value:"lineage",children:"Lineage"}),Object(f.jsx)("option",{value:"country",children:"Country"}),Object(f.jsx)("option",{value:"aa",children:"Amino acid at site"}),Object(f.jsx)("option",{value:"none",children:"None"})]}),"aa"===o.variable&&Object(f.jsxs)("div",{className:" p-2 m-1 ml-0  text-gray-700",children:[" ",Object(f.jsx)("label",{className:"text-sm",children:"Gene"}),Object(f.jsx)("select",{className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-20 m-3 my-1",value:o.gene,onChange:function(e){return s(Object(c.a)(Object(c.a)({},o),{},{gene:e.target.value}))},children:u.all_genes.map((function(e){return Object(f.jsx)("option",{value:e,children:e},e)}))}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{className:"text-sm",children:"Residue"})," ",Object(f.jsx)(k.DebounceInput,{debounceTimeout:300,type:"number",value:o.residue,onChange:function(e){return s(Object(c.a)(Object(c.a)({},o),{},{residue:e.target.value}))},className:"border py-1 px-1 text-grey-darkest text-sm h-7 w-16 m-3 my-1"})]}),Object(f.jsxs)("div",{className:"hidden",children:["Colour lines"," ",Object(f.jsx)("input",{type:"checkbox",value:o.colourLines,onChange:function(e){return s(Object(c.a)(Object(c.a)({},o),{},{colourLines:e.target.value}))}})]})]})]}),Object(f.jsx)("div",{children:l&&Object(f.jsxs)("div",{className:"text-gray-500 mr-3",children:[Object(f.jsxs)("h2",{className:"text-xl mt-5 mb-4 text-gray-700",children:[Object(f.jsx)(S.a,{className:"inline-block mr-2"}),"Node info"]}),Object(f.jsx)("div",{className:"font-bold",children:h.names[l]?h.names[l]:Object(f.jsx)(f.Fragment,{children:"Un-named internal node"})}),h.genbanks[l]&&"unknown"!==h.genbanks[l]&&"nan"!==h.genbanks[l]&&Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Genbank:"})," ",Object(f.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline",href:"https://www.ncbi.nlm.nih.gov/nuccore/"+h.genbanks[l],children:h.genbanks[l]})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Date:"})," ",u.date_mapping[h.dates[l]]]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Lineage:"})," ",Object(f.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:"https://outbreak.info/situation-reports?pango="+u.lineage_mapping[h.lineages[l]],children:u.lineage_mapping[h.lineages[l]]})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{className:"font-semibold",children:"Country:"})," ",u.country_mapping[h.countries[l]]]}),Object(f.jsx)("span",{className:"font-semibold",children:"Mutations from root:"}),Object(f.jsx)("div",{className:"text-xs mr-5",children:g&&g.join(", ")})]})})]})},A=n(191),z=n.n(A);var P=function(e){var t=e.enabled,n=e.setEnabled;return Object(f.jsxs)("div",{className:"w-full ".concat(t?"":"hidden"),children:[Object(f.jsx)("div",{onClick:function(){return n(!1)},className:"fixed w-full h-full bg-black opacity-80 z-40"}),Object(f.jsxs)("div",{onClick:function(){return n(!1)},className:"fixed w-full h-full  opacity-100 z-40",children:[Object(f.jsxs)("div",{className:" relative mx-auto mt-5 p-5 bg-white shadow-md z-100 w-4/5 overflow-y-auto opacity-100 ",style:{height:"90vh"},children:[Object(f.jsx)("button",{className:"absolute top-5 right-5 text-xl font-bold",onClick:function(){return n(!1)},children:"X"}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl",children:"About Cov2Tree"}),"This website allows you to explore a phylogenetic tree with more than a million SARS-Cov-2 sequences, sequenced by researchers around the world. The interface was made by"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"http://theo.io/",children:"Theo Sanderson"})," ","using a custom-developed open-source library called"," ",Object(f.jsxs)("a",{href:"http://github.com/theosanderson/taxodium",className:"text-blue-700 underline",children:[" ","Taxodium"]}),".",Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-6",children:"The sequences"}),Object(f.jsxs)("p",{children:["This tree displays sequences generated by scientists all over the world. The sequences are sourced from GenBank (i.e. the INSDC databases), the China National Center for Bioinformation, and from COG-UK. They are collated"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2//",children:"here"})," ","by Angie Hinrichs and others at UCSC."]}),Object(f.jsx)("p",{children:"This website would be empty but for the hard work of all these researchers, and their openness in submitting their work to public databases, and we gratefully acknowledge this."}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-6",children:"The tree"}),Object(f.jsxs)("p",{children:["The tree shown here is produced by the UCSC team, and made available"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2//",children:"here"}),". It is derived from releases of Rob Lanfear's"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://github.com/roblanf/sarscov2phylo",children:"sarscov2phylo"}),", pruned to include only public sequences aggregated from GenBank, COG-UK, and the China National Center for Bioinformation. The tree has been re-rooted to Wuhan/Hu-1 (GenBank MN908947.3, RefSeq NC_045512.2), and nodes with no associated mutations have been collapsed. Sequences released after the final sarscov2phylo release (Nov. 13, 2020) have been added to the tree using"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://github.com/yatisht/usher",children:"UShER"}),", developed by Yatish Turakhia. UShER development and tree inference was done in Russ Corbett-Detig and David Haussler's groups at the UCSC Genomics Institute. It is described here only for completeness. UCSC provide metadata with the sequences, including lineages called by"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://www.pango.network/",children:"Pangolin"}),"."]}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-4",children:"Citations"}),Object(f.jsxs)("div",{className:"text-sm",children:[Object(f.jsx)("p",{children:"Lanfear, Rob (2020). A global phylogeny of SARS-CoV-2 sequences from GISAID. Zenodo DOI: 10.5281/zenodo.3958883"}),Object(f.jsx)("p",{children:"Turakhia et al. (2021). Ultrafast Sample Placement on Existing Trees (UShER) Empowers Real-Time Phylogenetics for the SARS-CoV-2 Pandemic."}),Object(f.jsx)("p",{children:"Rambaut et al. (2020). A dynamic nomenclature proposal for SARS-CoV-2 lineages to assist genomic epidemiology."})]}),Object(f.jsx)("h1",{className:"font-bold mb-3 text-xl mt-4",children:"Related tools"}),Object(f.jsx)("div",{className:"text-sm",children:Object(f.jsxs)("p",{children:["You can also explore large phylogenies using"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://pando.tools",children:"Pando"}),","," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://microreact.org/",children:"Microreact"}),", and sampled phylogenies on"," ",Object(f.jsx)("a",{className:"text-blue-700 underline",href:"https://nextstrain.org/",children:"NextStrain"}),"."]})})]})," "]})]})},E=n(193),U=n(36),L=function(e){return"?"+Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")},D=function(e){for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var r=Object(s.a)(a[n],2),o=r[0],i=r[1];void 0!==i&&(t[o]=encodeURIComponent(i))}return t},F=function(e){var t=Object(U.d)(),n=Object(U.e)(),r=n.pathname,o=n.search,i=Object(a.useMemo)((function(){return function(e){var t={};return new URLSearchParams(e).forEach((function(e,n){t[n]=e})),t}(o)}),[o]),l=Object(a.useRef)({decodedSearch:i,pathname:r});Object(a.useEffect)((function(){l.current={decodedSearch:i,pathname:r}}),[i,r]);var u=Object(a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"push",a=l.current,r=a.pathname,o=a.decodedSearch;t[n](r+L(D(Object(c.a)(Object(c.a)({},o),e))))}),[t]);return[Object(a.useMemo)((function(){return Object.assign({},e,function(e){for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var r=Object(s.a)(a[n],2),o=r[0],i=r[1];void 0!==i&&(t[o]=i)}return t}(i))}),[i,e]),u]},B=n(239);B.parse.defaults.keepCase=!0;var W=[[255,0,0],[183,0,255],[255,213,0],[0,0,255],[0,255,255]];var G=function(){var e=Object(a.useState)({index:null}),t=Object(s.a)(e,2),n=t[0],r=t[1],o=F({search:JSON.stringify([{id:.123,category:"lineage",value:"",enabled:!0,aa_final:"any",min_tips:1,aa_gene:"S"}]),colourBy:JSON.stringify({variable:"lineage",gene:"S",colourLines:!1,residue:"681"})}),l=Object(s.a)(o,2),u=l[0],d=l[1],b=Object(a.useMemo)((function(){return JSON.parse(u.search)}),[u.search]),m=Object(a.useCallback)((function(e){d(Object(c.a)(Object(c.a)({},u),{},{search:JSON.stringify(e)}))}),[d,u]),j=Object(a.useCallback)((function(e){d(Object(c.a)(Object(c.a)({},u),{},{colourBy:JSON.stringify(e)}))}),[d,u]),h=Object(a.useMemo)((function(){return JSON.parse(u.colourBy)}),[u.colourBy]),g=Object(a.useCallback)((function(e){j(e)}),[j]),p=Object(a.useState)({status:"not_attempted",data:{node_data:{ids:[]}}}),x=Object(s.a)(p,2),O=x[0],v=x[1],y=Object(a.useState)(null),w=Object(s.a)(y,2),N=w[0],_=w[1],k=Object(a.useState)(!1),M=Object(s.a)(k,2),T=M[0],R=M[1];Object(a.useEffect)((function(){"not_attempted"===O.status&&(console.log("starting dl"),v({status:"loading",progress:0,data:{node_data:{ids:[]}}}),B.load("./tree.proto").then((function(e){z.a.get("/nodelist.pb",{responseType:"arraybuffer",onDownloadProgress:function(e){var t=Math.floor(e.loaded/1e8*1*100);v({status:"loading",progress:t,data:{node_data:{ids:[]}}})}}).then((function(e){return e.data})).then((function(t){console.log("buffer loaded");var n=e.lookupType("AllData"),a=n.decode(new Uint8Array(t)),r=n.toObject(a);r.node_data.ids=Object(i.a)(Array(r.node_data.x.length).keys()),console.log(r.mutation_mapping);var o=new Set;r.mutation_mapping=r.mutation_mapping.map((function(e,t){var n={},a=e.split(":"),r=Object(s.a)(a,2),i=r[0],c=r[1];if(c){var l=c.split("_"),u=Object(s.a)(l,3),d=u[0],b=u[1],m=u[2];n.gene=i,n.position=b,n.orig_res=d,n.final_res=m,o.add(i)}return n.id=t,n})),console.log(r.mutation_mapping),r.all_genes=Array.from(o).sort(),v({status:"loaded",data:r})}))})))}),[O.status]);var A=Object(a.useMemo)((function(){return"loaded"===O.status?O.data:{node_data:{ids:[]}}}),[O]),U=Object(a.useMemo)((function(){return A.node_data.ids.filter((function(e){return""!==A.node_data.names[e]}))}),[A]);console.log(b);var L=Object(a.useMemo)((function(){var e=b.map((function(e,t){var n;window.nd=A.node_data;var a=e.value.toLowerCase().trim();if("mutation"===e.category){window.mm=A.mutation_mapping;var r=A.mutation_mapping.filter((function(t){return t.gene===e.aa_gene&&t.position===e.aa_pos&&t.final_res===e.aa_final|"any"===e.aa_final})).map((function(e){return e.id}));console.log(r),n=function(t){return A.node_data.mutations[t]&&A.node_data.mutations[t].mutation&&r.filter((function(e){return A.node_data.mutations[t].mutation.includes(e)})).length>0&&A.node_data.num_tips[t]>=e.min_tips&&A.node_data.parents[t]!==t}}"name"===e.category&&(n=function(e){return A.node_data.names[e].toLowerCase().includes(a)}),"country"===e.category&&(n=function(e){return A.country_mapping[A.node_data.countries[e]].toLowerCase()===a}),"lineage"===e.category&&(n=function(e){return A.lineage_mapping[A.node_data.lineages[e]].toLowerCase()===a});var o="mutation"===e.category|(null!==e.value&&""!==e.value)&&e.enabled;return{original_index:t,id:"main-search-"+t,enabled:o,data:""!==e.value|"mutation"===e.category?A.node_data.ids.filter(n):[],opacity:.7,getRadius:7+2*t,filled:!1,stroked:!0,radiusUnits:"pixels",lineWidthUnits:"pixels",lineWidthScale:1,getPosition:function(e){return[A.node_data.x[e],A.node_data.y[e]]},getFillColor:function(e){return[0,0,0]},getLineColor:function(e){return W[t%W.length]}}})),t=e.map((function(e){return e.data.length}));return[e.filter((function(e){return e.enabled})),t,U.length]}),[A,b,U]),D=Object(s.a)(L,3),G=D[0],q=D[1],V=D[2];return console.log("cfg",G),Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(P,{enabled:T,setEnabled:R}),Object(f.jsxs)("div",{className:"h-screen w-screen",children:[Object(f.jsx)("div",{className:"from-gray-500 to-gray-600 bg-gradient-to-bl h-15 shadow-md z-20",children:Object(f.jsxs)("div",{className:"flex justify-between",children:[Object(f.jsxs)("h1",{className:"text-xl p-4  pb-5 text-white ",children:[Object(f.jsx)(E.a,{className:"inline-block h-8 w-8 pr-2 "}),Object(f.jsx)("span",{className:"font-bold",children:"Cov2Tree"}),":"," ",Object(f.jsxs)("span",{className:"font-light",children:["interactive SARS-CoV-2 phylogeny"," "]})]}),Object(f.jsx)("div",{className:"inline-block p-4",children:Object(f.jsxs)("button",{onClick:function(){return R(!0)},className:"mr-10 text-white font-bold hover:underline",children:[Object(f.jsx)(S.b,{className:"inline-block h-7 w-8"})," About / Acknowledgements"]})})]})}),Object(f.jsx)("div",{className:"main_content",children:Object(f.jsxs)("div",{className:"md:grid md:grid-cols-12 h-full",children:[Object(f.jsx)("div",{className:"md:col-span-8 h-3/6 md:h-full w-full",children:Object(f.jsx)(C,{search_configs_initial:G,scatterIds:U,searchColors:W,setSelectedNode:_,searchItems:b,data:A,progress:O.progress,colourBy:h,zoomToSearch:n})}),Object(f.jsx)("div",{className:"md:col-span-4 h-full bg-white  border-gray-600   pl-5 shadow-xl",children:Object(f.jsx)(I,{setZoomToSearch:r,totalSeqs:V,numSearchResults:q,searchColors:W,selectedNode:N,searchItems:b,data:A,setSearchItems:m,colourBy:h,setColourBy:g})})]})})]})]})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,280)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),o(e),i(e)}))},V=n(149);o.a.render(Object(f.jsx)(V.a,{children:Object(f.jsx)(G,{})}),document.getElementById("root")),q()}},[[257,1,2]]]);
//# sourceMappingURL=main.bb00fc3c.chunk.js.map